{"version":3,"sources":["webpack://MVISI3D/webpack/universalModuleDefinition","webpack://MVISI3D/webpack/bootstrap","webpack://MVISI3D/./MVisi3D/src/visi3D/MUtility.js","webpack://MVISI3D/./MVisi3D/src/visi3D/MSky.js","webpack://MVISI3D/./MVisi3D/src/visi3D/MSmc.js","webpack://MVISI3D/./MVisi3D/src/visi3D/MEvent3DArr.js","webpack://MVISI3D/./MVisi3D/src/visi3D/index.js","webpack://MVISI3D/(webpack)/buildin/global.js","webpack://MVISI3D/./MVisi3D/src/visi3D/MVisi3D.js","webpack://MVISI3D/./MVisi3D/src/visi3D/MEffectArray.js","webpack://MVISI3D/./MVisi3D/src/visi3D/MPosition3d.js","webpack://MVISI3D/./MVisi3D/src/visi3D/MShadowMeshContainer.js","webpack://MVISI3D/./MVisi3D/src/visi3D/MFoto3D.js","webpack://MVISI3D/./MVisi3D/src/visi3D/MFocus.js","webpack://MVISI3D/./MVisi3D/src/visi3D/MEventSob.js","webpack://MVISI3D/./MVisi3D/src/visi3D/MEvent3D.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","_MSky","_interopRequireDefault","_MSmc","_MFocus","MUtility","_parent","self","this","parent","_debug","debugInit","shadowHelper","undefined","spotLightHelper","gridHelper","FIXATION","ROTATION_X","ROTATION_Z","DISTANCE","CUB_HEIGHT","CUB_WIDTH","SKY_X","SKY_Y","SKY_Z","_fixation","_rotationX","_rotationZ","_distance","_cubHeight","_cubWidth","sky","default","smc","focus","funDebug","plane","THREE","Mesh","PlaneBufferGeometry","rotateX","Math","PI","MeshLambertMaterial","color","Color","castShadow","receiveShadow","GridHelper","rotation","x","CameraHelper","sunLight","shadow","camera","DirectionalLightHelper","groupObject","add","scene","remove","render","update","upDate","dragSunLight","camPos","position","set","applyAxisAngle","Vector3","staticShadow","xVerh","yVerh","zVerh","target","copy","shadowPrintPos","distanceTo","distanceUpdateShadow","shadowNeedsUpdate","dragSunLight2","dragSunLight3","near","far","updateProjectionMatrix","sunActiv","objShadow","group","ambientActiv","ambientLight","debug","v","rotationX","rotationZ","shadRotZ","fixation","distance","cubHeight","cubWidth","right","left","top","bottom","MSky","tt","_active","RADIUS","POS_X","POS_Y","POS_Z","LINK","COLOR","_radius","_link","_color","_shadRotZ","_rotZ","_x","_y","_z","mesh","cont3d","cont3d1","textur","init","geometry","SphereGeometry","loader","TextureLoader","loaderHDR","RGBELoader","material","MeshBasicMaterial","side","BackSide","scale","Object3D","y","dergActiv","dergLink","map","needsUpdate","checkFormat","load","intRend","encoding","RGBEEncoding","minFilter","NearestFilter","magFilter","flipY","link","indexOf","length","z","active","radius","rotZ","a","split","_MShadowMeshContainer","MSmc","_visible","WH","_wn","_obj3d","fotoPosition","fotoWH","content3d","visible","dergObj","arrObj","clear","addObj","obj3d","wh","_wh","_MEventSob","_MEvent3D","MEvent3DArr","par","contentHTML","stage","cameraPosition","raycaster","Raycaster","intersects","point","Vector2","pointWH","arrChild","uuid","eventSob","event3D","xzNull","poiskName","tokoName","_activ","rect","width","height","setRect","w","h","removeChild","child","splice","addChild","push","boolNum","boolNumOld","event","mouseRay","rayPusk","getGoodParam","dispatcherEvent","face","faceIndex","uv","originalEvent","getPosition","str","restartPoint","e3D","getNameEvent","testVisiParam","type","notActiv","setFromMatrixPosition","matrixWorld","ray","origin","direction","unproject","sub","normalize","intersectObjects","naCont","mousemove","e","data","preventDefault","zdvigX","pV","pl102","global","isRect","mouseup","mousedown","mouseout","mouseover","mousewheel","addDragEvent","cont","on","pl102Wheel","removeDragEvent","off","sizeWindow","_width","_height","activ","_MVisi3D","_MEvent3DArr","MVisi3D","g","Function","_MEffectArray","_MPosition3d","_MUtility","_contentHTML","_content2d","_devas","_directional","_efect","_event3DArr","_alpha","devas","arrSetiScene","_xVerh","_yVerh","_zVerh","_zume","_arrOut","yes3d","intRendOk","_isDragPan","_activMouse","_staticShadow","alwaysRender","AMBIEN_COLOR","AMBIEN_INTENSITY","LIGHT_COLOR","LIGHT_BIAS","SHADOW_INTENSITY","SHADOW_RADIUS","SHADOW_WH","FOV","FAR","content","graphics","eval","interactive","Scene","PerspectiveCamera","renderer","WebGLRenderer","setSize","setClearColor","antialias","alpha","shadowMap","enabled","PCFSoftShadowMap","efect","event3DArr","domElement","appendChild","style","zIndex","group1","group2","group3d","gCGG","gCAngel","gCam1","gCam2","ggCam","axesHelper","AxesHelper","arrPoint","disLig","powerLig","dis","bbbbbb","AmbientLight","sunIntensity","DirectionalLight","mapSize","bias","initOut","position3d","utility","arrayDoRender","beginFill","drawRect","endFill","aspect","obj","bol","webGL","transparent","opacity","children","addEvent","fun","removeEvent","addChildMouse","removeChildMouse","autoUpdate","zume","arrOut","setValue","visibility","isDragPan","activMouse","minZum","maxZum","maxRotationX","minMaxX","minRotationX","MEffectArray","_visi3D","_startArray","visi3D","composer","EffectComposer","RENDER_PASS","OUTLINE_PASS","OUTLINE_COLOR","OUTLINE_COLOR1","STRJSON","SAOJSON","TAA_PASS","SAMPLE_LEVEL","STEREO_PASS","SHADER_PASS","SAO_PASS","SSAO_PASS","_renderPass","_outlinePass","_outlineColor","_outlineColor1","_strJSON","_taaPass","_sampleLevel","_stereoPass","_shaderPass","_saoPass","_saoJSON","jsonCheck","_text","JSON","parse","setObjInObj","_o","_str","_o1","s1","_typeof","array","sah","EffectScene","RenderPass","OutlinePass","effect","visibleEdgeColor","hiddenEdgeColor","TAARenderPass","ShaderPass","FXAAShader","uniforms","_w","_h","prevFar","prevNear","SAOPass","params","_key","_key1","_param","selectedObjects","drawRender","renderToScreen","addPass","_ssaoPass","redrag","startArray","setArrayMash","_tip","_array","b","passes","unbiased","_effect","renderPass","outlinePass","outlineColor","trace","outlineColor1","strJSON","taaPass","sampleLevel","shaderPass","saoPass","saoJSON","StereoEffect","_stereo","StereoCamera","updateMatrixWorld","size","getSize","setScissorTest","setScissor","setViewport","cameraL","cameraR","PeppersGhostEffect","_halfWidth","scope","cameraDistance","reflectFromAbove","_cameraF","_cameraB","_cameraL","_cameraR","_position","_quaternion","Quaternion","_scale","autoClear","decompose","quaternion","translateZ","lookAt","translateX","ParallaxBarrierEffect","_camera","OrthographicCamera","_scene","_params","LinearFilter","format","RGBAFormat","_renderTargetL","WebGLRenderTarget","_renderTargetR","_material","ShaderMaterial","mapLeft","texture","mapRight","vertexShader","join","fragmentShader","pixelRatio","getPixelRatio","AnaglyphEffect","colorMatrixLeft","Matrix3","fromArray","colorMatrixRight","dispose","AsciiEffect","charSet","options","bResolution","iScale","bColor","bAlpha","bBlock","bInvert","document","createElement","cursor","iWidth","iHeight","oImg","oAscii","round","fResolution","oCanvas","backgroundColor","rows","cells","cellSpacing","cellPadding","oStyle","display","whiteSpace","margin","padding","letterSpacing","fLetterSpacing","fontFamily","strFont","fontSize","fFontSize","lineHeight","fLineHeight","textAlign","textDecoration","initAsciiSize","canvasRenderer","oCtx","clearRect","drawImage","oCanvasImg","oImgData","getImageData","strChars","iCharIdx","fBrightness","iOffset","iRed","iGreen","iBlue","iAlpha","floor","aCharList","strThisChar","innerHTML","asciifyImage","aDefaultCharList","aDefaultColorCharList","getContext","strResolution","SSAARenderPass","clearColor","clearAlpha","Pass","CopyShader","console","error","copyShader","copyUniforms","UniformsUtils","clone","copyMaterial","premultipliedAlpha","blending","AdditiveBlending","depthTest","depthWrite","camera2","scene2","quad2","frustumCulled","assign","constructor","sampleRenderTarget","writeBuffer","readBuffer","jitterOffsets","JitterVectors","max","min","oldClearColor","getClearColor","getHex","oldClearAlpha","getClearAlpha","baseSampleWeight","jitterOffset","setViewOffset","sampleWeight","clearViewOffset","accumulate","delta","accumulateIndex","holdRenderTarget","numSamplesPerFrame","pow","accumulationWeight","content2d","drag","sPixi","pause","point1","powerZum","distMinMaxBox","isRotateScene","sceneRotationY","getStage","stageMoveNew","isMovePan","panEnd","clientX","clientY","panDelta","subVectors","panStart","moveCamXY","shiftKey","stageUpNew","isMouseEvents","isTouchEvents","mouseUpp","www","mouseDown","button","panOffset","panLeft","objectMatrix","setFromMatrixColumn","multiplyScalar","panUp","pan","deltaX","deltaY","element","isPerspectiveCamera","targetDistance","tan","fov","clientHeight","warn","arguments","_MFoto3D","MShadowMeshContainer","_foto3D","generateUUID","normalVector","lightPosition4D","Plane","Vector4","box","Box3","foto3D","tp","twh","imageBlur","ImageBlur","canvas","isTime","texturePlan","Texture","matPlan","MeshPhongMaterial","DoubleSide","canvasGG","CanvasGG","arrColorStopTranspanent","arrProcent","textureShadow","shadowContent3d","meshPlan","meshLight","SphereBufferGeometry","arrShadowMesh","_dunamic","dirty","_lightPosition4D","_fotoPosition","_fotoWH","_imgWH","_imgBlur","_imgAlpha","_offsetY","_scaleShadow","_isDinamFotoRect","_opacityMat","clipPlanes","_shadowMaterial","clippingPlanes","clipIntersection","arrDataSempl","DataSempl","helpers","Group","meshShad","setConstMax","constant","setConstMin","sc","bridge","obj1","userData","targetObject","Error","arr","findRecMesh","replaceMaterialMesh","removeObj","index","len","opacityMat","dunamic","isInFotoRectMesh","isChangeMesh","isChangeObj","shadowMesh","colisTarget","colisShadow","setFromObject","isColRect","equals","isEqualsTransform","applyTransfornRec","applyTransforn","time","updateShadowUv","updateShadowMatrixMesh","addObjFoto","isDinamFotoRect","offsetFotoDinamRect","moveToRect","getCanvas","imgWH","setCanvas","_blur","blur","updateTexturePlan","timeEnd","onUpdate","boundingBoxUv","updateUvMesh","isUpdateUvMesh","wpos","getWorldPosition","wrot","getWorldQuaternion","maxHeight","pos","rot","scaleShadow","boundingBox","py","Geometry","faces","vertices","faceVertexUvs","localToWorld","getProcent","uvsNeedUpdate","arrPosition","attributes","arrUvAttribut","Float32Array","addAttribute","BufferAttribute","arrUv","arrIndex","itemSize","count","ind","indP","indUv","corectUVShadow","updateShadowTexture","setShadowColor","getConfig","setConfig","sss","x1","y1","w1","h1","x2","y2","w2","h2","val","okrug","isNaN","parseFloat","abs","getBase64","toDataURL","context","img","Image","b64","_blur1","image","setBase64","_b64","onload","src","filter","globalAlpha","position1","px","px1","py1","gradient","createLinearGradient","addColorStop","fillStyle","fill","defineProperties","offsetY","imgBlur","imgAlpha","shadowMaterial","ShadowMesh","j","SCREEN_WIDTH","SCREEN_HEIGHT","Clock","preserveDrawingBuffer","fotoContainer","background","setPixelRatio","devicePixelRatio","localClippingEnabled","boxHelper","BoxHelper","arrHelper","animate","center","removeObjFoto","moveToObj","orbitControls","zoom","getFoto","prev","imgData","OrbitControls","enableKeys","minDistance","minZoom","maxZoom","addEventListener","MFocus","box3","rectScreen","Rectangle","world","isMoveCam","isFromGeometry","_offset","offsetVector","vec","center3","doZoom","zumeVisi3D","divideScalar","updateBound3d","isEmpty","countStep","debugFocus","mid","low","high","updateRectScreen","isZoomIn","makeEmpty","getCompoundBoundingBox","expandByPoint","getCenter","boxs","getBoxObject","setRectFromBox","box2","boxToScreen","updateWorldSize","b2","traverseBound","node","computeBoundingBox","applyMatrix4","union","traverseVisible","Box2","arrP","b3","toScreenXY","res","v1","traverseGeom","isGeometry","isBufferGeometry","attribute","fromBufferAttribute","vectorScreen","vector3","v3","project","offset","MFocusDebug","mFocus","main","materialAlphaRed","PIXI","Graphics","hitArea","lineStyle","depth","arrSobName","arrSob","pozSob","tipSob","Event3D"],"mappings":"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","file":"MVisi3D.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"MVISI3D\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"MVISI3D\"] = factory();\n\telse\n\t\troot[\"MVISI3D\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"MVisi3D/build/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n","\r\nimport MSky from './MSky.js';\r\nimport MSmc from './MSmc.js';\r\nimport MFocus from './MFocus.js';\r\n\r\nexport default function MUtility (_parent) {\r\n\tvar self = this;\r\n\r\n\tthis.parent = _parent;\r\n\r\n\tthis._debug = false;\r\n\r\n\tthis.debugInit = false;\r\n\tthis.shadowHelper = undefined;\r\n\tthis.spotLightHelper = undefined;\r\n\tthis.gridHelper = undefined;\r\n\r\n\tthis.FIXATION = false;\r\n\tthis.ROTATION_X = 0;\r\n\tthis.ROTATION_Z = 0;\r\n\tthis.DISTANCE = this.parent.DISTANCE;\r\n\tthis.CUB_HEIGHT = this.parent.CUB_HEIGHT;\r\n\tthis.CUB_WIDTH = this.parent.CUB_WIDTH;\r\n\tthis.SKY_X = 0;\r\n\tthis.SKY_Y = 0;\r\n\tthis.SKY_Z = 0;\r\n\r\n\tthis._fixation = this.FIXATION;\r\n\tthis._rotationX = this.ROTATION_X;\r\n\tthis._rotationZ = this.ROTATION_Z;\r\n\tthis._distance = this.DISTANCE;\r\n\tthis._cubHeight = this.CUB_HEIGHT;\r\n\tthis._cubWidth = this.CUB_WIDTH;\r\n\r\n\t// задний фон\r\n\tthis.sky = new MSky(this);\r\n\tthis.smc = new MSmc(this);\r\n\tthis.focus = new MFocus(this.parent);\r\n\r\n\tthis.funDebug = function () {\r\n\r\n\t\tif (this.debugInit != true) {\r\n\t\t\tthis.debugInit = true;\r\n\t\t\tthis.plane = new THREE.Mesh(new THREE.PlaneBufferGeometry(1000, 1000).rotateX(-Math.PI), new THREE.MeshLambertMaterial({color: new THREE.Color(0xacacac)}));\r\n\t\t\tthis.plane.castShadow = this.plane.receiveShadow = true;\r\n\r\n\t\t\tthis.gridHelper = new THREE.GridHelper(1000, 10);\r\n\t\t\tthis.gridHelper.rotation.x = -Math.PI / 2;\r\n\t\t\tthis.shadowHelper = new THREE.CameraHelper(this.parent.sunLight.shadow.camera);\r\n\t\t\tif (this.parent.sunLight) this.spotLightHelper = new THREE.DirectionalLightHelper(this.parent.sunLight);\r\n\t\t}\r\n\r\n\t\tif (this._debug == true) {\r\n\r\n\t\t\tif (this.gridHelper.parent == null) this.parent.groupObject.add(this.gridHelper);\r\n\t\t\tif (this.plane.parent == null) this.parent.groupObject.add(this.plane);\r\n\t\t\tif (this.shadowHelper.parent == null) this.parent.scene.add(this.shadowHelper);\r\n\r\n\r\n\t\t\tif (this.parent.sunLight) {\r\n\t\t\t\tif (this.parent.sunLight.parent != null) {\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (this.spotLightHelper.parent != null) this.parent.scene.remove(this.spotLightHelper);\r\n\t\t\t\t\tif (this.shadowHelper.parent != null) this.parent.scene.remove(this.shadowHelper);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\r\n\t\t\tif (this.gridHelper.parent != null) this.parent.groupObject.remove(this.gridHelper);\r\n\t\t\tif (this.plane.parent != null) this.parent.groupObject.remove(this.plane);\r\n\t\t\tif (this.shadowHelper.parent != null) this.parent.scene.remove(this.shadowHelper);\r\n\t\t\tif (this.parent.sunLight) {\r\n\t\t\t\tif (this.spotLightHelper.parent != null) this.parent.scene.remove(this.spotLightHelper);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.render = function () {\r\n\t\tif (this._debug == true) {\r\n\t\t\tif (this.spotLightHelper != undefined) this.spotLightHelper.update();\r\n\t\t}\r\n\t\tthis.smc.render();\r\n\t\tthis.sky.render();\r\n\t\tthis.focus.upDate();\r\n\t\tthis.dragSunLight();\r\n\t};\r\n\r\n\r\n\tvar d = 0;\r\n\tthis.dragSunLight = function () {\r\n\t\tif (this.parent.sunLight == undefined) return;\r\n\t\tif (this.parent.sunLight.parent == null) return;\r\n\r\n\t\tif (self._fixation === true) {\r\n\t\t\td = this._distance + this._cubHeight * 2;\r\n\t\t\tself.parent.sunLight.position.set(0, d, 0);// занулили\r\n\t\t\tself.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(1, 0, 0), self._rotationX);\r\n\t\t\tself.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(0, 1, 0), self._rotationZ - self.parent._rotationZ);\r\n\t\t} else {\r\n\t\t\td = this._distance + this._cubHeight;\r\n\t\t\tthis.parent.sunLight.position.set(0, d, 0);// занулили\r\n\t\t\tthis.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(1, 0, 0), this._rotationX);\r\n\t\t\tthis.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(0, 1, 0), this._rotationZ);\r\n\r\n\t\t\tif (this.parent.staticShadow) {\r\n\t\t\t\tmoveSunToCam();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar shadowPrintPos = new THREE.Vector3();\r\n\tthis.distanceUpdateShadow = 500; // на каком растоянии будет постоянно обновляться тень\r\n\tfunction moveSunToCam () {\r\n\r\n\t\tvar camPos = new THREE.Vector3(self.parent.xVerh, self.parent.yVerh, self.parent.zVerh);\r\n\t\tself.parent.sunLight.position.add(camPos);\r\n\t\tself.parent.sunLight.target.position.copy(camPos);\r\n\r\n\t\tif (shadowPrintPos.distanceTo(camPos) > self.distanceUpdateShadow) {\r\n\t\t\tshadowPrintPos.copy(camPos);\r\n\t\t\tself.parent.shadowNeedsUpdate = true;\r\n\t\t}\r\n\t}\r\n\r\n\tthis.dragSunLight2 = function () {\r\n\t\tif (this.parent.sunLight == undefined) return;\r\n\t\tif (this.parent.sunLight.parent == null) return;\r\n\t\tif (this._fixation === true) {\r\n\t\t} else {\r\n\t\t\td = this._distance + this._cubHeight * 2;\r\n\t\t\tthis.parent.sunLight.position.set(0, d, 0);// занулили\r\n\t\t\tthis.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(1, 0, 0), this._rotationX);\r\n\t\t\tthis.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(0, 1, 0), this._rotationZ);\r\n\t\t}\r\n\t};\r\n\r\n\tthis.dragSunLight3 = function () {\r\n\t\tif (this.parent.sunLight) {\r\n\t\t\tthis.parent.sunLight.shadow.camera.near\t= 0 + this._cubHeight;// this._distance;\r\n\t\t\tthis.parent.sunLight.shadow.camera.far = this._cubHeight * 2 + this._cubHeight; // +this._distance ;\r\n\t\t\tthis.parent.sunLight.shadow.camera.updateProjectionMatrix();\r\n\t\t\tif (this.shadowHelper) this.shadowHelper.update();\r\n\r\n\t\t}\r\n\t};\r\n\r\n\tthis.sunActiv=function(value){\r\n\t\tthis.parent.objShadow(this.parent.group, value);\r\n\t\tif (value == true) {\r\n\t\t\tif (this.parent.sunLight.parent == undefined){\r\n\t\t\t\tthis.parent.scene.add(this.parent.sunLight);\r\n\t\t\t\tthis.parent.scene.add(self.parent.sunLight.target)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this.parent.sunLight.parent != undefined){\r\n\t\t\t\tthis.parent.scene.remove(this.parent.sunLight);\r\n\t\t\t\tthis.parent.scene.remove(self.parent.sunLight.target)\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.funDebug();\r\n\t}\r\n\tthis.ambientActiv=function(value){\r\n\t\tif (value == true) {\r\n\t\t\tif (this.parent.ambientLight.parent == undefined)this.parent.scene.add(this.parent.ambientLight);\r\n\t\t} else {\r\n\t\t\tif (this.parent.ambientLight.parent != undefined)this.parent.scene.remove(this.parent.ambientLight);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nMUtility.prototype = {\r\n\tset debug (v) {\r\n\r\n\t\tif (this._debug === v) return;\r\n\t\tthis._debug = v;\r\n\t\tthis.funDebug();\r\n\t},\r\n\tget debug () {\r\n\t\treturn this._debug;\r\n\t},\r\n\r\n\tset rotationX (v) {\r\n\t\tif (this._rotationX === v) return;\r\n\t\tthis._rotationX = v;\r\n\t\tif (this.spotLightHelper != undefined) {\r\n\t\t\tthis.parent.sunLight.shadow.camera.updateProjectionMatrix();\r\n\t\t\tthis.spotLightHelper.update();\r\n\t\t}\r\n\t\tthis.dragSunLight2();\r\n\t},\r\n\tget rotationX () {\r\n\t\treturn this._rotationX;\r\n\t},\r\n\r\n\tset rotationZ (v) {\r\n\t\tif (this._rotationZ === v) return;\r\n\t\tthis._rotationZ = v;\r\n\t\tthis.sky.shadRotZ = v;\r\n\t\tif (this.spotLightHelper != undefined) this.spotLightHelper.update();\r\n\t\tthis.dragSunLight2();\r\n\t},\r\n\tget rotationZ () {\r\n\t\treturn this._rotationZ;\r\n\t},\r\n\r\n\tset fixation (v) {\r\n\t\tif (this._fixation === v) return;\r\n\t\tthis._fixation = v;\r\n\t\tthis.dragSunLight2();\r\n\t},\r\n\tget fixation () {\r\n\t\treturn this._fixation;\r\n\t},\r\n\r\n\tset distance (v) {\r\n\t\tif (this._distance === v) return;\r\n\t\tthis._distance = v;\r\n\t\tthis.dragSunLight3();\r\n\t\tthis.dragSunLight2();\r\n\t},\r\n\tget distance () {\r\n\t\treturn this._distance;\r\n\t},\r\n\r\n\tset cubHeight (v) {\r\n\t\tif (this._cubHeight === v) return;\r\n\t\tthis._cubHeight = v;\r\n\r\n\t\tthis.dragSunLight3();\r\n\t\tthis.dragSunLight2();\r\n\t},\r\n\tget cubHeight () {\r\n\t\treturn this._cubHeight;\r\n\t},\r\n\r\n\r\n\tset cubWidth (v) {\r\n\t\tif (this._cubWidth === v) return;\r\n\t\tthis._cubWidth = v;\r\n\r\n\t\tif (this.parent.sunLight) {\r\n\t\t\tthis.parent.sunLight.shadow.camera.right = this._cubWidth;\r\n\t\t\tthis.parent.sunLight.shadow.camera.left = -this._cubWidth;\r\n\t\t\tthis.parent.sunLight.shadow.camera.top\t= this._cubWidth;\r\n\t\t\tthis.parent.sunLight.shadow.camera.bottom = -this._cubWidth;\r\n\t\t\tthis.parent.sunLight.shadow.camera.updateProjectionMatrix();\r\n\t\t\tif (this.shadowHelper) this.shadowHelper.update();\r\n\t\t}\r\n\t},\r\n\tget cubWidth () {\r\n\t\treturn this._cubWidth;\r\n\t}\r\n};\r\n","export default function MSky (_parent) {\r\n\tthis.parent = _parent;\r\n\tvar self = this;\r\n\tthis._active = false;\r\n\r\n\r\n\tthis.RADIUS = 1000;\r\n\r\n\tthis.POS_X = 0;\r\n\tthis.POS_Y = 0;\r\n\tthis.POS_Z = 0;\r\n\r\n\tthis.LINK = 'null';\r\n\tthis.COLOR = '0xffffff';\r\n\r\n\tthis._radius = this.RADIUS;\r\n\tthis._link = this.LINK;\r\n\tthis._color = this.COLOR;\r\n\tthis._shadRotZ = this.parent.ROTATION_Z;\r\n\tthis._rotZ = 0;\r\n\r\n\tthis._x = this.POS_X;\r\n\tthis._y = this.POS_Y;\r\n\tthis._z = this.POS_Z;\r\n\r\n\tthis.mesh = undefined;\r\n\r\n\tthis.cont3d = undefined;\r\n\tthis.cont3d1 = undefined;\r\n\tthis.textur = undefined;\r\n\r\n\tthis.init = function () {\r\n\t\tif (this.mesh != undefined) return;\r\n\t\tthis.geometry = new THREE.SphereGeometry(1, 32, 32);\r\n\t\tthis.loader = new THREE.TextureLoader();\r\n\t\tthis.loaderHDR = new THREE.RGBELoader();\r\n\r\n\t\tthis.material = new THREE.MeshBasicMaterial({\r\n\t\t\tside: THREE.BackSide,\r\n\t\t\tcolor: 0xffffff\r\n\t\t});\r\n\r\n\t\tthis.mesh = new THREE.Mesh(this.geometry, this.material);\r\n\t\tthis.mesh.scale.set(this._radius, this._radius, this._radius);\r\n\r\n\t\tthis.cont3d = new THREE.Object3D();\r\n\t\tthis.cont3d1 = new THREE.Object3D();\r\n\t\tthis.cont3d.add(this.cont3d1);\r\n\t\tthis.cont3d1.add(this.mesh);\r\n\r\n\t\tthis.cont3d1.rotation.y = this._shadRotZ;\r\n\t\tthis.mesh.rotation.y = this._rotZ;\r\n\r\n\t\tthis.cont3d.rotation.x = -Math.PI / 2;\r\n\r\n\t};\r\n\r\n\tthis.dergActiv = function () {\r\n\t\tif (this._active == true) {\r\n\t\t\tif (this.cont3d.parent == null) this.parent.parent.groupObject.add(this.cont3d);\r\n\t\t} else {\r\n\t\t\tif (this.cont3d.parent != null) this.parent.parent.groupObject.remove(this.cont3d);\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tvar tt;\r\n\tthis.dergLink = function () {\r\n\t\tif (this._link == 'null') { // сносим мапу\r\n\t\t\tif (this.material.map != null) {\r\n\t\t\t\tthis.material.map = null;\r\n\t\t\t\tthis.material.needsUpdate = true;\r\n\t\t\t}\r\n\t\t} else { // грузим новую\r\n\t\t\ttt = this.checkFormat(this._link);\r\n\t\t\tif (tt == 0) { // щбычная\r\n\t\t\t\tthis.loader.load(this._link, function (textur) {\r\n\t\t\t\t\tself.textur = textur;\r\n\t\t\t\t\tself.material.map =\ttextur;\r\n\t\t\t\t\tself.material.needsUpdate = true;\r\n\t\t\t\t\tself.parent.parent.intRend = 1;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif (tt == 1) { // hdr\r\n\t\t\t\tthis.loaderHDR.load(this._link, function (textur) {\r\n\t\t\t\t\tself.textur = textur;\r\n\r\n\t\t\t\t\tself.textur.encoding = THREE.RGBEEncoding;\r\n\t\t\t\t\tself.textur.minFilter = THREE.NearestFilter;\r\n\t\t\t\t\tself.textur.magFilter = THREE.NearestFilter;\r\n\t\t\t\t\tself.textur.flipY = true;\r\n\t\t\t\t\tself.material.map =\ttextur;\r\n\t\t\t\t\tself.material.needsUpdate = true;\r\n\t\t\t\t\tself.parent.parent.intRend = 1;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis.checkFormat = function (link) {\r\n\t\tif (link.indexOf('.png') !== -1) return 0;\r\n\t\tif (link.indexOf('.jpeg') !== -1) return 0;\r\n\t\tif (link.indexOf('.jpg') !== -1) return 0;\r\n\r\n\t\tif (link.length > 150) { // это бейс 64 хз какой но не хдр наверно)))\r\n\t\t\tif (link.indexOf('png') !== -1) return 0;\r\n\t\t\tif (link.indexOf('jpeg') !== -1) return 0;\r\n\t\t\tif (link.indexOf('jpg') !== -1) return 0;\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\treturn 1;\r\n\t};\r\n\r\n\r\n\tthis.render = function () {\r\n\t\t/* if(this.mesh==undefined)return\r\n\t\tif(this._active == false)return\r\n\r\n\t\tif(this._rotationZ!=this.parent.parent.rotationZ){\r\n\t\t\tthis._rotationZ=this.parent.parent.rotationZ\r\n\t\t\t//this.cont3d1.rotation.y=this._rotationZ\r\n\t\t} */\r\n\r\n\t};\r\n\r\n\r\n}\r\nMSky.prototype = {\r\n\tset x (v) {\r\n\t\tif (this._x === v) return;\r\n\t\tthis._x = v;\r\n\t\tthis.cont3d.position.x = v;\r\n\t\tthis.parent.parent.intRend = 1;\r\n\t},\r\n\tget x () {\r\n\t\treturn this._x;\r\n\t},\r\n\r\n\tset y (v) {\r\n\t\tif (this._y === v) return;\r\n\t\tthis._y = v;\r\n\t\tthis.cont3d.position.y = v;\r\n\t\tthis.parent.parent.intRend = 1;\r\n\t},\r\n\tget y () {\r\n\t\treturn this._y;\r\n\t},\r\n\r\n\tset z (v) {\r\n\t\tif (this._z === v) return;\r\n\t\tthis._z = v;\r\n\t\tthis.cont3d.position.z = v;\r\n\t\tthis.parent.parent.intRend = 1;\r\n\t},\r\n\tget z () {\r\n\t\treturn this._z;\r\n\t},\r\n\r\n\tset active (v) {\r\n\t\tif (this._active === v) return;\r\n\t\tthis._active = v;\r\n\t\tthis.init();\r\n\t\tthis.dergActiv();\r\n\t},\r\n\tget active () {\r\n\t\treturn this._active;\r\n\t},\r\n\r\n\tset radius (v) {\r\n\t\tif (this._radius === v) return;\r\n\t\tthis._radius = v;\r\n\t\tif (this.mesh != undefined) {\r\n\t\t\tthis.mesh.scale.set(this._radius, this._radius, this._radius);\r\n\t\t}\r\n\r\n\t},\r\n\tget radius () {\r\n\t\treturn this._radius;\r\n\t},\r\n\r\n\tset link (v) {\r\n\t\tif (this._link === v) return;\r\n\t\tthis._link = v;\r\n\t\tthis.init();\r\n\t\tthis.dergLink();\r\n\t\t/* if(this._link==\"null\"){\r\n\t\t\tthis.material\r\n\t\t} */\r\n\r\n\t},\r\n\tget link () {\r\n\t\treturn this._link;\r\n\t},\r\n\r\n\tset shadRotZ (v) {\r\n\t\tif (this._shadRotZ === v) return;\r\n\t\tthis._shadRotZ = v;\r\n\t\tif (this.mesh != undefined) {\r\n\t\t\tthis.cont3d1.rotation.y = this._shadRotZ;\r\n\t\t}\r\n\r\n\t},\r\n\tget shadRotZ () {\r\n\t\treturn this._shadRotZ;\r\n\t},\r\n\r\n\tset rotZ (v) {\r\n\t\tif (this._rotZ === v) return;\r\n\t\tthis._rotZ = v;\r\n\t\tif (this.mesh != undefined) {\r\n\t\t\tthis.mesh.rotation.y = this._rotZ;\r\n\t\t}\r\n\r\n\t},\r\n\tget rotZ () {\r\n\t\treturn this._rotZ;\r\n\t},\r\n\r\n\tset color (v) {\r\n\t\tif (this._color === v) return;\r\n\t\tthis._color = v;\r\n\t\tthis.init();\r\n\t\tvar c = this._color;\r\n\t\tif (typeof c === 'string') {\r\n\t\t\tif (c.indexOf('x') != -1) {\r\n\t\t\t\tvar a = c.split('x');\r\n\t\t\t\tc = '#' + a[1];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.material.color = new THREE.Color(c);\r\n\r\n\t},\r\n\tget color () {\r\n\t\treturn this._color;\r\n\t}\r\n};\r\n","\r\nimport MShadowMeshContainer from './MShadowMeshContainer.js';\r\n\r\nexport default function MSmc (_parent) {\r\n\tthis.parent = _parent;\r\n\tvar self = this;\r\n\tthis._active = false;\r\n\tthis._visible = true;\r\n\r\n\tthis.WH = 512;\r\n\r\n\tthis._wn = this.WH;\r\n\tthis._obj3d = undefined;\r\n\r\n\tthis.smc = undefined;\r\n\r\n\r\n\tthis.init = function () {\r\n\t\tif (this.smc != undefined) return;\r\n\t\tthis.smc = new MShadowMeshContainer();\r\n\t\tthis.smc.fotoPosition.set(-this._wn / 2, -this._wn / 2);\r\n\t\tthis.smc.fotoWH = this._wn;\r\n\t\tthis.smc.content3d.rotation.x = -Math.PI / 2;\r\n\t\tthis.smc.content3d.position.y = -1;\r\n\t\tthis.smc.content3d.visible = this._visible;\r\n\t\tthis.dergObj();\r\n\t};\r\n\tthis.dergActiv = function () {\r\n\r\n\t\tif (this._active == true) {\r\n\t\t\tif (this.smc.content3d.parent == null) this.parent.parent.groupObject.add(this.smc.content3d);\r\n\t\t} else {\r\n\t\t\tif (this.smc.content3d.parent != null) this.parent.parent.groupObject.remove(this.smc.content3d);\r\n\t\t}\r\n\r\n\t};\r\n\r\n\r\n\tthis.render = function () {\r\n\r\n\t\tif (this.smc == undefined) return;\r\n\t\tif (this.smc.content3d.parent != null) {\r\n\t\t\tthis.smc.upDate();\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tthis.dergObj = function () {\r\n\t\tif (this.smc == undefined)\treturn;\r\n\t\tif (this._obj3d != undefined) {\r\n\t\t\tif (this.smc.arrObj[0] == this._obj3d) {\r\n\r\n\t\t\t} else {\r\n\t\t\t\tthis.smc.clear();\r\n\t\t\t\tthis.smc.addObj(this._obj3d);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tthis.smc.clear();\r\n\t\t}\r\n\t};\r\n\r\n\r\n}\r\nMSmc.prototype = {\r\n\tset active (v) {\r\n\t\tif (this._active === v) return;\r\n\t\tthis._active = v;\r\n\t\tthis.init();\r\n\t\tthis.dergActiv();\r\n\t},\r\n\tget active () {\r\n\t\treturn this._active;\r\n\t},\r\n\tset visible (v) {\r\n\t\tif (this._visible === v) return;\r\n\t\tthis._visible = v;\r\n\t\tif (this.smc == undefined) return;\r\n\t\tthis.smc.content3d.visible = v;\r\n\r\n\t},\r\n\tget visible () {\r\n\t\treturn this._visible;\r\n\t},\r\n\tset obj3d (v) {\r\n\t\tif (this._obj3d === v) return;\r\n\t\tthis._obj3d = v;\r\n\t\tthis.dergObj();\r\n\r\n\t},\r\n\tget obj3d () {\r\n\t\treturn this._obj3d;\r\n\t},\r\n\tset wh (v) {\r\n\t\tif (this._wh === v) return;\r\n\t\tthis._wh = v;\r\n\t\tif (this.smc == undefined) return;\r\n\r\n\t\tthis.smc.fotoPosition.set(-this._wn / 2, -this._wn / 2);\r\n\t\tthis.smc.fotoWH = this._wn;\r\n\t},\r\n\tget wh () {\r\n\t\treturn this._wh;\r\n\t}\r\n};\r\n","\r\nimport MEventSob from './MEventSob.js';\r\nimport MEvent3D from './MEvent3D.js';\r\n\r\nexport default function MEvent3DArr (par, camera, contentHTML, stage) {\r\n\tthis.parent = par;\r\n\tvar self = this;\r\n\tthis.camera = camera;\r\n\tthis.raycaster = new THREE.Raycaster();\r\n\tthis.intersects;\r\n\r\n\tthis.point = new THREE.Vector2(0, 0);\r\n\tthis.pointWH = new THREE.Vector2(0, 0);\r\n\tthis.arrChild = [];\r\n\r\n\tthis.uuid = 'nullMy';\r\n\tthis.obj3d;\r\n\r\n\tthis.eventSob = new MEventSob();\r\n\tthis.event3D = new MEvent3D();\r\n\r\n\tthis.xzNull = 'xzNull';\r\n\tthis.poiskName = 'xzPoisk';\r\n\tthis.tokoName = 'null';\r\n\r\n\tthis._activ = true;\r\n\r\n\tthis.rect = {x: 0, y: 0, width: 100, height: 100};\r\n\r\n\tthis.setRect = function (x, y, w, h) {\r\n\t\tthis.rect.x = x;\r\n\t\tthis.rect.y = y;\r\n\t\tthis.rect.width = w;\r\n\t\tthis.rect.height = h;\r\n\t};\r\n\r\n\tthis.removeChild = function (child) {\r\n\t\tfor (var i = 0; i < this.arrChild.length; i++) {\r\n\t\t\tif (child.uuid == this.arrChild[i].uuid) {\r\n\t\t\t\tthis.arrChild.splice(i, 1);\r\n\t\t\t\ti = i - 1;\r\n\t\t\t\tif (i < 0)i = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis.addChild = function (child) {\r\n\t\tthis.arrChild.push(child);\r\n\r\n\t};\r\n\r\n\tvar cameraPosition;\r\n\tthis.boolNum = -1;\r\n\tthis.boolNumOld = -1;\r\n\tthis.event;\r\n\tthis.mouseRay = function () {\r\n\r\n\t\tif (this._activ == false) return;\r\n\r\n\t\tthis.rayPusk();\r\n\r\n\t\tthis.boolNum = this.getGoodParam();\r\n\r\n\t\tif (this.boolNum == -1) {\r\n\t\t\tif (this.uuid != 'nullMy') {\r\n\t\t\t\tthis.eventSob.dispatcherEvent('out', this.event3D);\r\n\t\t\t\tthis.uuid = 'nullMy';\r\n\t\t\t}\r\n\t\t} else {\r\n\r\n\t\t\tif (this.uuid != 'nullMy') { // обьект есть\r\n\r\n\t\t\t\tif (this.uuid != this.intersects[this.boolNum].object.uuid) { // это новый обьект\r\n\r\n\t\t\t\t\tthis.eventSob.dispatcherEvent('out', this.event3D);\r\n\t\t\t\t\tthis.uuid = this.intersects[this.boolNum].object.uuid;\r\n\r\n\t\t\t\t\tthis.event3D.target = this.intersects[this.boolNum].object;\r\n\t\t\t\t\tthis.event3D.face = this.intersects[this.boolNum].face;\r\n\t\t\t\t\tthis.event3D.point = this.intersects[this.boolNum].point;\r\n\t\t\t\t\tthis.event3D.faceIndex = this.intersects[this.boolNum].faceIndex;\r\n\t\t\t\t\tthis.event3D.uv = this.intersects[this.boolNum].uv;\r\n\t\t\t\t\tthis.event3D.originalEvent = self.event;\r\n\t\t\t\t\tthis.eventSob.dispatcherEvent('over', this.event3D);\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis.event3D.face = this.intersects[this.boolNum].face;\r\n\t\t\t\t\tthis.event3D.point = this.intersects[this.boolNum].point;\r\n\t\t\t\t\tthis.event3D.faceIndex = this.intersects[this.boolNum].faceIndex;\r\n\t\t\t\t\tthis.event3D.uv = this.intersects[this.boolNum].uv;\r\n\t\t\t\t\tthis.event3D.originalEvent = self.event;\r\n\t\t\t\t\tthis.eventSob.dispatcherEvent('move', this.event3D);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.uuid = this.intersects[this.boolNum].object.uuid;\r\n\t\t\t\tthis.event3D.target = this.intersects[this.boolNum].object;\r\n\t\t\t\tthis.event3D.face = this.intersects[this.boolNum].face;\r\n\t\t\t\tthis.event3D.point = this.intersects[this.boolNum].point;\r\n\t\t\t\tthis.event3D.faceIndex = this.intersects[this.boolNum].faceIndex;\r\n\t\t\t\tthis.event3D.uv = this.intersects[this.boolNum].uv;\r\n\t\t\t\tthis.event3D.originalEvent = self.event;\r\n\t\t\t\tthis.eventSob.dispatcherEvent('over', this.event3D);\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.boolNumOld = this.boolNum;\r\n\r\n\t};\r\n\r\n\tthis.getPosition = function (s) {\r\n\t\tvar str = this.poiskName;\r\n\r\n\t\tif (s != undefined) {\r\n\t\t\tthis.poiskName = s;\r\n\t\t} else {\r\n\t\t\tthis.poiskName = 'xzPoisk';\r\n\t\t}\r\n\r\n\t\tthis.restartPoint();\r\n\r\n\t\tthis.rayPusk();\r\n\r\n\r\n\t\tthis.poiskName = str;\r\n\t\tif (this.intersects.length != 0) {\r\n\t\t\t// var t =this.getGoodParam()\r\n\t\t\tvar t = this.intersects.length - 1;\r\n\t\t\tif (t == -1)t = 0;\r\n\t\t\treturn this.intersects[t];\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t};\r\n\r\n\tvar e3D = new MEvent3D();\r\n\t// Относительно имени возврощает евент\r\n\tthis.getNameEvent = function (str) {\r\n\t\tthis.restartPoint();\r\n\t\tthis.rayPusk();\r\n\r\n\t\tif (this.intersects.length != 0) {\r\n\t\t\tfor (var i = 0; i < this.intersects.length; i++) {\r\n\t\t\t\tif (this.intersects[i].object.parent != undefined) {\r\n\t\t\t\t\tif (this.intersects[i].object.name == str) {\r\n\t\t\t\t\t\te3D.target = this.intersects[this.boolNum].object;\r\n\t\t\t\t\t\te3D.face = this.intersects[this.boolNum].face;\r\n\t\t\t\t\t\te3D.point = this.intersects[this.boolNum].point;\r\n\t\t\t\t\t\te3D.faceIndex = this.intersects[this.boolNum].faceIndex;\r\n\t\t\t\t\t\te3D.uv = this.intersects[this.boolNum].uv;\r\n\t\t\t\t\t\te3D.originalEvent = self.event;\r\n\t\t\t\t\t\treturn e3D;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\r\n\r\n\tthis.testVisiParam = function (_obj3d) {\r\n\t\tif (_obj3d.visible == false) return false;\r\n\t\tif (_obj3d.parent != undefined) {\r\n\t\t\treturn this.testVisiParam(_obj3d.parent);\r\n\t\t} else {\r\n\t\t\tif (_obj3d.type == 'Scene') return true;\r\n\t\t\telse return false;\r\n\t\t}\r\n\t\treturn true;\r\n\t};\r\n\r\n\tthis.getGoodParam = function () {\r\n\r\n\t\tif (this.intersects.length != 0) {\r\n\t\t\tvar i;\r\n\r\n\t\t\tfor (i = 0; i < this.intersects.length; i++) {\r\n\t\t\t\tif (this.testVisiParam(this.intersects[i].object) != false) {\r\n\t\t\t\t\tif (this.intersects[i].object.notActiv != undefined) {\r\n\t\t\t\t\t\tthis.intersects.splice(i, 1);\r\n\t\t\t\t\t\ti = 0;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.intersects.length == 0) return -1;\r\n\r\n\t\t\tfor (i = 0; i < this.intersects.length; i++) {\r\n\t\t\t\tif (this.testVisiParam(this.intersects[i].object) != false) {\r\n\t\t\t\t\tif (this.intersects[i].object.name == this.poiskName) {\r\n\t\t\t\t\t\treturn i;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (i = 0; i < this.intersects.length; i++) {\r\n\t\t\t\tif (this.testVisiParam(this.intersects[i].object) != false) {\r\n\t\t\t\t\tif (this.intersects[i].object.name != this.xzNull) {\r\n\r\n\t\t\t\t\t\treturn i;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t};\r\n\t// пускаем лучь\r\n\tthis.rayPusk = function () {\r\n\t\tcameraPosition = new THREE.Vector3();\r\n\r\n\t\tcameraPosition.setFromMatrixPosition(this.camera.matrixWorld); // world position\r\n\t\tthis.raycaster.ray.origin.copy(cameraPosition);\r\n\r\n\t\tthis.raycaster.ray.direction.set(this.point.x, this.point.y, 0.5).unproject(this.camera).sub(cameraPosition).normalize();\r\n\t\tthis.intersects = this.raycaster.intersectObjects(this.arrChild, true);\r\n\r\n\t};\r\n\r\n\tthis.naCont = false;\r\n\r\n\tthis.mousemove = function (e) {\r\n\t\tif (self.naCont == false) return;\r\n\r\n\t\tif (e.data != undefined)self.event = e.data.originalEvent;\r\n\t\telse self.event = e;\r\n\t\tif (self._activ == false) return;\r\n\t\t// self.event.preventDefault();\r\n\r\n\t\tself.restartPoint(e);\r\n\r\n\r\n\t\tself.mouseRay();\r\n\t\tif (self.intersects.length) {\r\n\t\t\tself.event.preventDefault();\r\n\t\t}\r\n\t};\r\n\r\n\tthis.zdvigX = 0;\r\n\tthis.scale = 1;\r\n\tthis.pV = new THREE.Vector2(0, 0);\r\n\tthis.restartPoint = function (e) {\r\n\t\tself.pV.x = pl102.global.x;\r\n\t\tself.pV.y = pl102.global.y;\r\n\r\n\t\tif (self.isRect(self.pV) == true) {\r\n\t\t\tself.point.x = -((this.rect.x - self.pV.x) / this.rect.width) * 2 - 1;\r\n\t\t\tself.point.y = -(-((this.rect.y - self.pV.y) / this.rect.height) * 2 - 1);\r\n\t\t} else {\r\n\t\t\tif (self.point.x != 99999) {\r\n\t\t\t\tself.point.x = 99999;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis.isRect = function (point) {\r\n\t\tif ((point.x >= this.rect.x) && (point.x <= this.rect.x + this.rect.width)) {\r\n\t\t\tif ((point.y >= this.rect.y) && (point.y <= this.rect.y + this.rect.height)) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\r\n\tthis.mouseup = function (e) {\r\n\t\tif (e.data != undefined)self.event = e.data.originalEvent;\r\n\t\telse self.event = e;\r\n\r\n\t\tif (self._activ == false) return;\r\n\t\tif (self.boolNumOld == -1) {\r\n\t\t\tself.eventSob.dispatcherEvent('up', null);\r\n\t\t} else {\r\n\t\t\tself.event3D.originalEvent = self.event;\r\n\t\t\tself.eventSob.dispatcherEvent('up', self.event3D);\r\n\t\t}\r\n\t\tif (self.intersects.length) {\r\n\t\t\tself.event.preventDefault();\r\n\t\t}\r\n\t};\r\n\r\n\tthis.mousedown = function (e) {\r\n\t\tif (e.data != undefined)self.event = e.data.originalEvent;\r\n\t\telse self.event = e;\r\n\r\n\t\tself.restartPoint(e);\r\n\t\tif (self._activ == false) return;\r\n\t\tif (self.boolNumOld == -1) {\r\n\t\t\tself.eventSob.dispatcherEvent('down', null);\r\n\t\t} else {\r\n\t\t\tself.event3D.originalEvent = self.event;\r\n\t\t\tself.eventSob.dispatcherEvent('down', self.event3D);\r\n\t\t}\r\n\t\tif (self.intersects.length) {\r\n\t\t\tself.event.preventDefault();\r\n\t\t}\r\n\t};\r\n\r\n\tthis.mouseout = function (e) {\r\n\t\tself.naCont = false;\r\n\r\n\t\tself.restartPoint(e);\r\n\t\tself.point.x = 99999;\r\n\t\tself.mouseRay();\r\n\t};\r\n\tthis.mouseover = function (e) {\r\n\t\tself.naCont = true;\r\n\r\n\t\tself.restartPoint(e);\r\n\t\tself.mouseRay();\r\n\t};\r\n\r\n\tthis.mousewheel = function (e) {\r\n\t\tif (e.data != undefined)self.event = e.data.originalEvent;\r\n\t\telse self.event = e;\r\n\r\n\t\tself.restartPoint(e);\r\n\t\tif (self._activ == false) return;\r\n\t\tif (self.boolNumOld == -1) {\r\n\t\t\tself.eventSob.dispatcherEvent('down', null);\r\n\t\t} else {\r\n\t\t\tself.event3D.originalEvent = self.event;\r\n\t\t\tself.eventSob.dispatcherEvent('wheel', e);\r\n\t\t}\r\n\t};\r\n\r\n\tthis.addDragEvent = function (cont) {\r\n\t\tcont.on('mousemove', self.mousemove);\r\n\t\tcont.on('mouseup', self.mouseup);\r\n\t\tcont.on('mousedown', self.mousedown);\r\n\t\tcont.on('mouseout', self.mouseout);\r\n\t\tcont.on('mouseover', self.mouseover);\r\n\t\tpl102Wheel.on(cont, 'mousewheel', self.mousewheel);\r\n\t};\r\n\r\n\tthis.removeDragEvent = function (cont) {\r\n\t\tcont.off('mousemove', self.mousemove);\r\n\t\tcont.off('mouseup', self.mouseup);\r\n\t\tcont.off('mousedown', self.mousedown);\r\n\t\tcont.off('mouseout', self.mouseout);\r\n\t\tcont.off('mouseover', self.mouseover);\r\n\t\tpl102Wheel.off(cont, 'mousewheel', self.mousewheel);\r\n\t};\r\n\r\n\r\n\tthis.sizeWindow = function (_width, _height) {\r\n\t\tthis.pointWH.x = _width;\r\n\t\tthis.pointWH.y = _height;\r\n\t};\r\n}\r\n\r\nMEvent3DArr.prototype = {\r\n\tset activ (v) {\r\n\t\tif (this._activ == v) return;\r\n\t\tthis._activ = v;\r\n\t},\r\n\tget activ () {\r\n\t\treturn this._activ;\r\n\t}\r\n};\r\n","\r\nimport MVisi3D from './MVisi3D.js';\r\nimport MEvent3DArr from './MEvent3DArr.js';\r\n\r\nglobal.MVisi3D = MVisi3D;\r\nglobal.MEvent3DArr = MEvent3DArr;\r\n\r\nexport {\r\n\tMVisi3D,\r\n\tMEvent3DArr\r\n};","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","\r\nimport MEffectArray from './MEffectArray.js';\r\nimport MPosition3d from './MPosition3d.js';\r\nimport MEvent3DArr from './MEvent3DArr.js';\r\nimport MUtility from './MUtility.js';\r\n\r\nexport default function MVisi3D (_contentHTML, _content2d, _devas, _directional, _efect, _event3DArr, _alpha) {\r\n\tvar self = this;\r\n\r\n\t_devas = _devas !== undefined ? _devas : false;\r\n\t_directional = _directional !== undefined ? _directional : true;\r\n\t_efect = _efect !== undefined ? _efect : true;\r\n\t_event3DArr = _event3DArr !== undefined ? _event3DArr : true;\r\n\t_alpha = _alpha !== undefined ? _alpha : false;\r\n\r\n\tthis.devas = _devas;\r\n\r\n\tthis.arrSetiScene = [];\r\n\r\n\tthis._xVerh = 0;\r\n\tthis._yVerh = 0;\r\n\tthis._zVerh = 0;\r\n\tthis._rotationX = 0;\r\n\tthis._rotationZ = 0;\r\n\tthis._zume = 1000;\r\n\tthis._arrOut = [];\r\n\tthis._x = 0;\r\n\tthis._y = 0;\r\n\tthis._height = 100;\r\n\tthis._width = 100;\r\n\tthis.yes3d = true;\r\n\tthis.intRendOk = 1;\r\n\tthis._visible = true;\r\n\tthis._isDragPan = false;\r\n\tthis._activMouse = true;\r\n\tthis._staticShadow = false;\r\n\r\n\tthis.alwaysRender = false;\r\n\r\n\r\n\tthis.AMBIEN_COLOR = '#ffffff';// цвет амдеба\r\n\tthis.AMBIEN_INTENSITY = 0.79;// интенсивность амдеба\r\n\r\n\tthis.LIGHT_COLOR = '#ffffff';\r\n\tthis.LIGHT_BIAS = 0.001;\r\n\tthis.SHADOW_INTENSITY = 0.22;\r\n\tthis.SHADOW_RADIUS = 1;\r\n\tthis.SHADOW_WH = 4096;\r\n\tthis.DISTANCE = 0;\r\n\tthis.CUB_HEIGHT = 500;\r\n\tthis.CUB_WIDTH = 500;\r\n\r\n\r\n\tthis.FOV = 45;\r\n\tthis.FAR = 45000;\r\n\r\n\tthis.content = undefined;\r\n\tthis.graphics = undefined;\r\n\r\n\r\n\tif (_content2d != undefined) {\r\n\t\tthis.content = eval('new PIXI.Container()');\r\n\t\tthis.graphics = eval('new PIXI.Graphics()');\r\n\t\t_content2d.addChild(this.content);\r\n\t\tthis.content.addChild(this.graphics);\r\n\t\tthis.graphics.interactive = true;\r\n\t}\r\n\r\n\tthis.camera;\r\n\tthis.scene = new THREE.Scene();\r\n\r\n\tvar color = 0xffffff;\r\n\tthis.camera = new THREE.PerspectiveCamera(this.FOV, this._width / this._height, 1, this.FAR);\r\n\tif (this.devas == true) {\r\n\t\tthis.renderer = new THREE.WebGLRenderer();\r\n\t\tthis.renderer.setSize(this._width, this._height);\r\n\t\tthis.renderer.setClearColor(color, 1);\r\n\t} else {\r\n\t\tthis.renderer = new THREE.WebGLRenderer({antialias: true, alpha: _alpha});\r\n\t\tthis.renderer.shadowMap.enabled = true;\r\n\t\tthis.renderer.setSize(this._width, this._height);\r\n\t\tif (_alpha == true) this.renderer.setClearColor(color, 0);\r\n\t\telse this.renderer.setClearColor(color, 1);\r\n\t}\r\n\r\n\tthis.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n\tthis.efect;\r\n\tif (_efect == true) {\r\n\t\tthis.efect = new MEffectArray(this, []);\r\n\t\tthis.efect.init();\r\n\t}\r\n\r\n\tthis.event3DArr;\r\n\tif (_event3DArr == true) {\r\n\t\tthis.event3DArr = new MEvent3DArr(this, this.camera, this.renderer.domElement);\r\n\t\tthis.scene.event3DArr = this.event3DArr;\r\n\t\tthis.event3DArr.addDragEvent(this.graphics);\r\n\t\tthis.event3DArr.activ = this._activMouse;\r\n\t}\r\n\r\n\tthis.camera.position.set(0, 0, -60);\r\n\tthis.camera.rotation.set(Math.PI, 0, 0);\r\n\r\n\t_contentHTML.appendChild(this.renderer.domElement);\r\n\tthis.renderer.domElement.style.zIndex = -1;\r\n\tthis.renderer.domElement.style.position = 'fixed';\r\n\tthis.renderer.domElement.style.top = '0px';\r\n\tthis.renderer.domElement.style.left = '0px';\r\n\r\n\tthis.group = new THREE.Object3D();\r\n\tthis.group.rotation.x = Math.PI / 2;\r\n\tthis.scene.add(this.group);\r\n\tthis.group1 = new THREE.Object3D();\r\n\tthis.group.add(this.group1);\r\n\tthis.group2 = new THREE.Object3D();\r\n\tthis.group1.add(this.group2);\r\n\tthis.groupObject = new THREE.Object3D();\r\n\tthis.group2.add(this.groupObject);\r\n\r\n\tthis.group3d = new THREE.Object3D();\r\n\tthis.groupObject.add(this.group3d);\r\n\r\n\tthis.gCGG = new THREE.Object3D();\r\n\tthis.group.add(this.gCGG);\r\n\tthis.gCAngel = new THREE.Object3D();\r\n\tthis.gCGG.add(this.gCAngel);\r\n\tthis.gCam1 = new THREE.Object3D();\r\n\tthis.gCAngel.add(this.gCam1);\r\n\tthis.gCam2 = new THREE.Object3D();\r\n\tthis.gCam1.add(this.gCam2);\r\n\tthis.ggCam = new THREE.Object3D();\r\n\tthis.gCam2.add(this.ggCam);\r\n\tthis.ggCam.add(this.camera);\r\n\r\n\r\n\tthis.ggCam.position.z = -this._zume;\r\n\tthis.camera.position.z = 0;\r\n\r\n\tthis.axesHelper = new THREE.AxesHelper(100);\r\n\tthis.scene.add(this.axesHelper);\r\n\tthis.axesHelper.visible = false;\r\n\r\n\tthis.arrPoint = [];\r\n\tvar disLig = 4000;\r\n\tvar powerLig = 0.4;\r\n\tvar dis = 10000;\r\n\r\n\tthis.sunLight;\r\n\tthis.ambientLight = new THREE.AmbientLight(this.AMBIEN_COLOR, this.AMBIEN_INTENSITY);// 0.8);\r\n\tthis.scene.add(this.ambientLight);\r\n\tthis.ambientLight.castShadow = false;\r\n\r\n\tif (_directional == true) {\r\n\t\tvar sunIntensity = this.SHADOW_INTENSITY;\r\n\t\tthis.sunLight = new THREE.DirectionalLight(this.LIGHT_COLOR, sunIntensity, 0, 0, 0.2);\r\n\t\t// this.sunLight.position.set(  4500, this.offsetD, -8000);\r\n\t\tthis.sunLight.position.set(0, (this.DISTANCE + this.CUB_HEIGHT * 2), 0);\r\n\t\tthis.sunLight.castShadow = true;\r\n\t\tthis.sunLight.shadow.camera.near = this.CUB_HEIGHT;// 7000\r\n\t\tthis.sunLight.shadow.camera.far = this.CUB_HEIGHT + this.CUB_HEIGHT * 2;// 20000\r\n\r\n\t\tthis.sunLight.shadow.camera.right = this.CUB_WIDTH;\r\n\t\tthis.sunLight.shadow.camera.left = -this.CUB_WIDTH;\r\n\t\tthis.sunLight.shadow.camera.top\t= this.CUB_WIDTH;\r\n\t\tthis.sunLight.shadow.camera.bottom = -this.CUB_WIDTH;\r\n\t\tthis.sunLight.shadow.mapSize.width = this.SHADOW_WH;\r\n\t\tthis.sunLight.shadow.mapSize.height = this.SHADOW_WH;\r\n\t\tthis.sunLight.shadow.bias = this.LIGHT_BIAS;\r\n\t\tthis.sunLight.shadow.radius = this.SHADOW_RADIUS;\r\n\t}\r\n\r\n\tthis.initOut = function () {};\r\n\r\n\tthis.position3d = new MPosition3d(self, this.graphics);\r\n\tthis.utility = new MUtility(self);\r\n\r\n\tthis.arrayDoRender = [];\r\n\tthis.shadowNeedsUpdate = false;\r\n\r\n\tthis.render = function () {\r\n\t\tif (this.yes3d == false) return;\r\n\t\tthis.utility.render();\r\n\t\tthis.intRend = 10;\r\n\t\tif (this.shadowNeedsUpdate) {\r\n\t\t\tthis.shadowNeedsUpdate = false;\r\n\t\t\tthis.renderer.shadowMap.needsUpdate = true;\r\n\t\t}\r\n\r\n\t\tif (this.efect) {\r\n\t\t\tif (this.efect.render() == false) this.renderer.render(this.scene, this.camera);\r\n\t\t} else this.renderer.render(this.scene, this.camera);\r\n\r\n\r\n\t\tif (this.arrayDoRender.length != 0) {\r\n\t\t\tfor (var i = 0; i < this.arrayDoRender.length; i++) this.arrayDoRender[i]();\r\n\t\t}\r\n\r\n\t};\r\n\tthis.upDate = function () {\r\n\t\tif (this.alwaysRender || (this.intRend == this.intRendOk)) {\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t\tif (this.intRend < 10) this.intRend++;\r\n\t};\r\n\r\n\tthis.renderer.render(this.scene, this.camera);\r\n\r\n\tthis.sizeWindow = function (_x, _y, _width, _height) {\r\n\r\n\t\tif (_x != undefined) this._x = _x;\r\n\t\tif (_y != undefined) this._y = _y;\r\n\t\tif (_height != undefined) this._height = _height;\r\n\t\tif (_width != undefined) this._width = _width;\r\n\r\n\t\tif (this.content != undefined) {\r\n\t\t\tthis.content.x = this._x;\r\n\t\t\tthis.content.y = this._y;\r\n\t\t\tthis.graphics.clear();\r\n\t\t\tthis.graphics.beginFill(0xff0000, 0.0);\r\n\t\t\tthis.graphics.drawRect(0, 0, this._width, this._height);\r\n\t\t\tthis.graphics.endFill();\r\n\t\t}\r\n\r\n\t\tthis.renderer.domElement.style.left = this._x + 'px';\r\n\t\tthis.renderer.domElement.style.top = this._y + 'px';\r\n\r\n\t\tthis.camera.aspect = this._width / this._height;\r\n\t\tthis.camera.updateProjectionMatrix();\r\n\t\tthis.renderer.setSize(this._width, this._height);\r\n\t\tthis.intRend = 1;\r\n\r\n\t\tif (this.event3DArr) {\r\n\t\t\tthis.event3DArr.sizeWindow(this._width, this._height);\r\n\t\t\tthis.event3DArr.setRect(this._x, this._y, this._width, this._height);\r\n\t\t}\r\n\t\tif (this.efect) this.efect.sizeWindow(this._width, this._height);\r\n\t};\r\n\r\n\tthis.render();\r\n\tthis.sizeWindow();\r\n\r\n\tvar bbbbbb;\r\n\t// Набрасываем на объекты тени\r\n\tthis.objShadow = function (obj, bol) {\r\n\t\tif (this.devas.devas == true) {\r\n\t\t\tbol = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.devas.webGL == false) {\r\n\t\t\tbol = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (bol == undefined) bol = true;\r\n\r\n\r\n\t\tbbbbbb = true;\r\n\t\tif (obj.material) {\r\n\t\t\tif (obj.material.transparent == true && obj.material.opacity < 1) {\r\n\t\t\t\tbbbbbb = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (bbbbbb == true) {\r\n\t\t\tobj.castShadow = bol;\r\n\t\t\tobj.receiveShadow = bol;\r\n\t\t}\r\n\r\n\t\tif (obj.children != undefined) {\r\n\t\t\tfor (var i = 0; i < obj.children.length; i++) {\r\n\t\t\t\tif (obj.children != undefined) {\r\n\t\t\t\t\tthis.objShadow(obj.children[i], bol);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbbbbbb = true;\r\n\t\t\t\t\tif (obj.children[i].material) {\r\n\t\t\t\t\t\tif (obj.material.transparent == true && obj.material.opacity < 1) {\r\n\t\t\t\t\t\t\tbbbbbb = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (bbbbbb == true) {\r\n\t\t\t\t\t\tobj.children[i].castShadow = bol;\r\n\t\t\t\t\t\tobj.children[i].receiveShadow = bol;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis.addEvent = function (str, fun) { if (this.event3DArr) this.event3DArr.eventSob.addEvent(str, fun); };\r\n\tthis.removeEvent = function (str, fun) { if (this.event3DArr) this.event3DArr.eventSob.removeEvent(str, fun); };\r\n\r\n\tthis.addChildMouse = function (child) { if (this.event3DArr) this.event3DArr.addChild(child); };\r\n\tthis.removeChildMouse = function (child) { if (this.event3DArr) this.event3DArr.removeChild(child); };\r\n}\r\n\r\nMVisi3D.prototype = {\r\n\r\n\tset staticShadow (v) {\r\n\t\tthis.renderer.shadowMap.autoUpdate = !v;\r\n\t\tthis._staticShadow = v;\r\n\t},\r\n\tget staticShadow () {\r\n\t\treturn this._staticShadow;\r\n\t},\r\n\tset rotationX (v) {\r\n\t\tif (this._rotationX === v) return;\r\n\t\tthis._rotationX = v;\r\n\t\tthis.intRend = 1;\r\n\t\tthis.gCam2.rotation.x = v;\r\n\t},\r\n\tget rotationX () {\r\n\t\treturn this._rotationX;\r\n\t},\r\n\tset rotationZ (v) {\r\n\t\tif (this._rotationZ === v) return;\r\n\t\tthis._rotationZ = v;\r\n\t\tthis.gCam1.rotation.z = v;\r\n\t\tthis.intRend = 1;\r\n\t},\r\n\tget rotationZ () {\r\n\t\treturn this._rotationZ;\r\n\t},\r\n\tset zume (v) {\r\n\t\tif (this._zume === v) return;\r\n\t\tthis._zume = v;\r\n\t\tthis.ggCam.position.z = -v;\r\n\t\tthis.camera.position.z = 0;\r\n\t\tthis.intRend = 1;\r\n\t},\r\n\tget zume () {\r\n\t\treturn this._zume;\r\n\t},\r\n\tset yVerh (v) {\r\n\t\tthis._yVerh = v;\r\n\t\tthis.gCGG.position.z = v;\r\n\t\tthis.intRend = 1;\r\n\t},\r\n\tget yVerh () {\r\n\t\treturn this.gCGG.position.z;\r\n\t},\r\n\tset xVerh (v) {\r\n\t\tthis._xVerh = v;\r\n\t\tthis.gCGG.position.x = v;\r\n\t\tthis.intRend = 1;\r\n\t},\r\n\tget xVerh () {\r\n\t\treturn this.gCGG.position.x;\r\n\t},\r\n\tset zVerh (v) {\r\n\t\tthis._zVerh = v;\r\n\t\tthis.gCGG.position.y = v;\r\n\t\tthis.intRend = 1;\r\n\t},\r\n\tget zVerh () {\r\n\t\treturn this.gCGG.position.y;\r\n\t},\r\n\tset arrOut (v) {\r\n\t\tthis._arrOut = v;\r\n\t\tthis.efect.setValue('outline', null, this._arrOut);\r\n\t\tthis.intRend = 1;\r\n\t},\r\n\tget arrOut () {\r\n\t\treturn this._arrOut;\r\n\t},\r\n\tset x (v) {\r\n\t\tthis._x = v;\r\n\t\tthis.sizeWindow();\r\n\t},\r\n\tget x () {\r\n\t\treturn this._x;\r\n\t},\r\n\r\n\tset y (v) {\r\n\t\tthis._y = v;\r\n\t\tthis.sizeWindow();\r\n\t},\r\n\tget y () {\r\n\t\treturn this._y;\r\n\t},\r\n\r\n\tset height (v) {\r\n\t\tthis._height = v;\r\n\t\tthis.sizeWindow();\r\n\t},\r\n\tget height () {\r\n\t\treturn this._height;\r\n\t},\r\n\r\n\tset width (v) {\r\n\t\tthis._width = v;\r\n\t\tthis.sizeWindow();\r\n\t},\r\n\tget width () {\r\n\t\treturn this._width;\r\n\t},\r\n\tset visible (v) {\r\n\t\tthis._visible = v;\r\n\t\tthis.content.visible = v;\r\n\t\tthis.renderer.domElement.style.visibility = v ? 'visible' : 'hidden';\r\n\t},\r\n\tget visible () {\r\n\t\treturn this._visible;\r\n\t},\r\n\tset isDragPan (v) {\r\n\t\tthis._isDragPan = v;\r\n\t\tthis.position3d.isDragPan = v;\r\n\t},\r\n\tget isDragPan () {\r\n\t\treturn this._isDragPan;\r\n\t},\r\n\tset activMouse (v) {\r\n\t\tthis._activMouse = v;\r\n\t\tif (this.event3DArr) this.event3DArr.activ = this._activMouse;\r\n\r\n\t},\r\n\tget activMouse () {\r\n\t\treturn this._activMouse;\r\n\t},\r\n\tset minZum (v) {\r\n\t\tthis.position3d.minZum = v;\r\n\t},\r\n\tget minZum () {\r\n\t\treturn this.position3d.minZum;\r\n\t},\r\n\tset maxZum (v) {\r\n\t\tthis.position3d.maxZum = v;\r\n\t},\r\n\tget maxZum () {\r\n\t\treturn this.position3d.maxZum;\r\n\t},\r\n\tset maxRotationX (v) {\r\n\t\tthis.position3d.minMaxX.x = v;\r\n\t},\r\n\tget maxRotationX () {\r\n\t\treturn this.position3d.minMaxX.x;\r\n\t},\r\n\tset minRotationX (v) {\r\n\t\tif (v < this.rotationX) {\r\n\t\t\tthis.rotationX = v;\r\n\t\t}\r\n\t\tthis.position3d.minMaxX.y = v;\r\n\t},\r\n\tget minRotationX () {\r\n\t\treturn this.position3d.minMaxX.y;\r\n\t}\r\n};\r\n","\r\nexport default function MEffectArray (_visi3D, _startArray) {\r\n\tvar self = this;\r\n\r\n\tthis.visi3D = _visi3D;\r\n\tthis._startArray = [];// _startArray;\r\n\r\n\tthis._width = _visi3D._width;\r\n\tthis._height = _visi3D._height;\r\n\r\n\tthis.scene = this.visi3D.scene;\r\n\tthis.camera = this.visi3D.camera;\r\n\tthis.renderer = this.visi3D.renderer;\r\n\r\n\tthis.composer = new THREE.EffectComposer(this.renderer);\r\n\r\n\tthis.RENDER_PASS = false;\r\n\r\n\tthis.OUTLINE_PASS = false;\r\n\tthis.OUTLINE_COLOR = '#0000ff';\r\n\tthis.OUTLINE_COLOR1 = '#ff0000';\r\n\tthis.STRJSON = '{\"edgeGlow\":0,\"usePatternTexture\":false,\"edgeThickness\":1,\"edgeStrength\":3,\"downSampleRatio\":2,\"pulsePeriod\":0}';\r\n\tthis.SAOJSON = '{\"saoBlur\":true,\"output\":0,\"saoBias\":0,\"saoBlurDepthCutoff\":0,\"saoBlurRadius\":8,\"saoBlurStdDev\":4,\"saoIntensity\":0.18,\"saoKernelRadius\":100,\"saoMinResolution\":0,\"saoScale\":11.58}';\r\n\r\n\tthis.TAA_PASS = false;\r\n\tthis.SAMPLE_LEVEL = 0;\r\n\r\n\tthis.STEREO_PASS = false;\r\n\r\n\tthis.SHADER_PASS = false;\r\n\tthis.SAO_PASS = false;\r\n\tthis.SSAO_PASS = false;\r\n\r\n\r\n\tthis._renderPass = this.RENDER_PASS;\r\n\tthis._outlinePass = this.OUTLINE_PASS;\r\n\tthis._outlineColor = this.OUTLINE_COLOR;\r\n\tthis._outlineColor1 = this.OUTLINE_COLOR1;\r\n\tthis._strJSON = this.STRJSON;\r\n\r\n\tthis._taaPass = this.TAA_PASS;\r\n\tthis._sampleLevel = this.SAMPLE_LEVEL;\r\n\r\n\r\n\tthis._stereoPass = this.STEREO_PASS;\r\n\r\n\r\n\tthis._shaderPass = this.SHADER_PASS;\r\n\tthis._saoPass = this.SAO_PASS;\r\n\tthis._saoJSON = this.SAOJSON;\r\n\r\n\tthis.jsonCheck = function (_text) {\r\n\t  \tif (_text == undefined) return false;\r\n\t  \tif (typeof _text !== 'string') return false;\r\n\t\tif (_text.indexOf('\":') == -1) return false;\r\n\t\tif (_text.indexOf('}') == -1) return false;\r\n\t  \tif (_text === 'null') return false;\r\n\r\n\t  \ttry {\r\n\t   \t\tJSON.parse(_text);\r\n\t  \t} catch (e) {\r\n\t   \t\treturn false;\r\n\t \t}\r\n\t  \treturn true;\r\n\t};\r\n\r\n\r\n\tthis.setObjInObj = function (_o, _str) {\r\n\t\tif (this.jsonCheck(_str) == false) return;\r\n\t\tvar _o1 = JSON.parse(_str);\r\n\t\tvar t;\r\n\r\n\t\tfor (var s1 in _o1) {\r\n\t\t\tfor (var s in _o) {\r\n\t\t\t\tif (s == s1) {\r\n\t\t\t\t\tt = typeof _o1[s];\r\n\t\t\t\t\tif (t == 'object') {\r\n\t\t\t\t\t\tthis.setObjInObj(_o[s], _o1[s]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t_o[s] = _o1[s];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis.array = [];\r\n\tthis.object = {};\r\n\r\n\tthis.init = function () {\r\n\r\n\t\tif (this.array.length != 0) return;\r\n\r\n\t\tvar sah = 0;\r\n\t\t// RenderPass Нх нужно не знаю но нужно, наверно проверить FIXE  js/postprocessing/TAARenderPass.js\r\n\t\tthis.array[sah] = new EffectScene(new THREE.RenderPass(this.scene, this.camera));\r\n\t\tthis.array[sah].type = 'RenderPass';\r\n\t\t// this.composer.addPass(this.array[sah].effect);\r\n\t\tsah++;\r\n\r\n\r\n\t\tthis.array[sah] = new EffectScene(new THREE.OutlinePass(new THREE.Vector2(this._width, this._height), this.scene, this.camera));\r\n\t\tthis.array[sah].type = 'OutlinePass';\r\n\r\n\r\n\t\tthis.array[sah].effect.visibleEdgeColor = new THREE.Color(this._outlineColor);\r\n\t\tthis.array[sah].effect.hiddenEdgeColor = new THREE.Color(this._outlineColor1);\r\n\r\n\r\n\t\tsah++;\r\n\r\n\r\n\t\tthis.array[sah] = new EffectScene(new THREE.TAARenderPass(this.scene, this.camera));\r\n\t\tthis.array[sah].type = 'TAARenderPass';\r\n\r\n\t\t/* sah++;\r\n\r\n\t\t// Сглаживание\r\n\t\tthis.array[sah] = new EffectScene(new THREE.StereoEffect(THREE.FXAAShader));\r\n\t\tthis.array[sah].type = 'StereoEffect';\r\n\r\n\r\n\t\t*/\r\n\r\n\r\n\t\tsah++;\r\n\r\n\t\t// Сглаживание\r\n\t\tthis.array[sah] = new EffectScene(new THREE.ShaderPass(THREE.FXAAShader));\r\n\t\tthis.array[sah].type = 'ShaderPass';\r\n\r\n\t\t// this.composer.addPass(this.array[sah].effect);\r\n\r\n\r\n\t\tthis.array[sah].effect.uniforms['resolution'].value.set(1 / this._width, 1 / this._height);\r\n\t\tthis.array[sah].sizeWindow = function (_w, _h) {\r\n\t\t\tthis.effect.uniforms['resolution'].value.set(1 / _w, 1 / _h);\r\n\t\t};\r\n\r\n\r\n\t\tsah++;\r\n\t\t// this.array[sah].effect.renderToScreen = false/*this._bSao ? false : true*/;\r\n\t\t// composer.addPass(effectFXAA);\r\n\r\n\t\t// SAO  тенюхи на кружочках\r\n\t\tvar prevFar = this.camera.far;\r\n\t\tvar prevNear = this.camera.near;\r\n\t\tthis.camera.far = 10;\r\n\t\tthis.camera.near = 3;\r\n\t\tthis.array[sah] = new EffectScene(new THREE.SAOPass(this.scene, this.camera, true, true));\r\n\t\t// this.array[sah].effect.renderToScreen = true;\r\n\t\tthis.array[sah].type = 'SAOPass';\r\n\t\tthis.camera.far = prevFar;\r\n\t\tthis.camera.near = prevNear;\r\n\r\n\t\t// var s = '{\"saoBlur\":true,\"output\":0,\"saoBias\":0,\"saoBlurDepthCutoff\":0,\"saoBlurRadius\":8,\"saoBlurStdDev\":4,\"saoIntensity\":0.18,\"saoKernelRadius\":100,\"saoMinResolution\":0,\"saoScale\":11.58}';\r\n\r\n\r\n\t\tsah++;/**/\r\n\r\n\t\t/* var prevFar = this.camera.far;\r\n\t\tvar prevNear = this.camera.near;\r\n\t\tthis.camera.far = 10;\r\n\t\tthis.camera.near = 3;\r\n\t\tthis.array[sah] = new EffectScene(new THREE.SAOPass(this.scene, this.camera, true, true));\r\n\t\t// this.array[sah].effect.renderToScreen = true;\r\n\t\tthis.array[sah].type = 'SSAOPass';\r\n\t\tthis.camera.far = prevFar;\r\n\t\tthis.camera.near = prevNear;\r\n\r\n\r\n\t\tsah++; */\r\n\r\n\r\n\t\tfor (var i = 0; i < this.array.length; i++) {\r\n\t\t\tthis.object[this.array[i].type] = this.array[i];\r\n\t\t}\r\n\t\tvar rr;\r\n\r\n\r\n\t\t// this.dragOutline()\r\n\t\tthis.setObjInObj(this.object['SAOPass'].effect.params, this._saoJSON);\r\n\t\tthis.setObjInObj(this.object['OutlinePass'].effect, this._strJSON);\r\n\t\tthis.sizeWindow(this._width, this._height);\r\n\t};\r\n\r\n\r\n\tvar p = -1;\r\n\tthis.setValue = function (_key, _key1, _param) {\r\n\t\tif (_key == 'outline') {\r\n\t\t\tif (this.object['OutlinePass'].activ == true) this.object['OutlinePass'].effect.selectedObjects = _param;\r\n\t\t}\r\n\t};\r\n\r\n\tthis.drawRender = function () {\r\n\t\tthis.clear();\r\n\t\tif (this._renderPass == true) {\r\n\t\t\tthis.object['RenderPass'].activ = true;\r\n\t\t\tthis.clear(true);\r\n\t\t\tthis.object['RenderPass'].effect.renderToScreen = true;\r\n\t\t\tthis.composer.addPass(this.object['RenderPass'].effect);\r\n\t\t}\r\n\t\tif (this._outlinePass == true) {\r\n\t\t\tthis.object['OutlinePass'].activ = true;\r\n\t\t\t// this.clear(true)\r\n\t\t\t// this.object['OutlinePass'].effect.renderToScreen = true;\r\n\t\t\tthis.composer.addPass(this.object['OutlinePass'].effect);\r\n\t\t}\r\n\r\n\r\n\t\tif (this._taaPass == true) {\r\n\t\t\tthis.object['TAARenderPass'].activ = true;\r\n\t\t\tthis.clear(true);\r\n\t\t\tthis.object['TAARenderPass'].effect.renderToScreen = true;\r\n\t\t\tthis.composer.addPass(this.object['TAARenderPass'].effect);\r\n\t\t}\r\n\r\n\r\n\t\tif (this._shaderPass == true) {\r\n\t\t\tthis.object['ShaderPass'].activ = true;\r\n\t\t\tthis.clear(true);\r\n\t\t\tthis.object['ShaderPass'].effect.renderToScreen = true;\r\n\t\t\tthis.composer.addPass(this.object['ShaderPass'].effect);\r\n\t\t}\r\n\r\n\t\tif (this._saoPass == true) {\r\n\t\t\tthis.object['SAOPass'].activ = true;\r\n\t\t\tthis.clear(true);\r\n\t\t\tthis.object['SAOPass'].effect.renderToScreen = true;\r\n\t\t\tthis.composer.addPass(this.object['SAOPass'].effect);\r\n\t\t}\r\n\r\n\t\tif (this._ssaoPass == true) {\r\n\t\t\tthis.object['SSAOPass'].activ = true;\r\n\t\t\tthis.clear(true);\r\n\t\t\tthis.object['SSAOPass'].effect.renderToScreen = true;\r\n\t\t\tthis.composer.addPass(this.object['SSAOPass'].effect);\r\n\t\t}\r\n\r\n\r\n\t};\r\n\r\n\r\n\tthis.redrag = function () {\r\n\r\n\t\tvar a = [];\r\n\t\tfor (var i = 1; i < self.array.length; i++) {\r\n\t\t\tif (self.array[i].activ == true) {\r\n\t\t\t\ta.push(self.array[i].type);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.startArray = a;\r\n\r\n\t};\r\n\r\n\r\n\tthis.setArrayMash = function (_tip, _array) {\r\n\t\t// if (this.array.length == 0) return;\r\n\t\t/* if (_tip == 'OutlinePass') {\r\n\t\t\tthis.object[_tip].effect.selectedObjects = _array;\r\n\t\t} */\r\n\t};\r\n\r\n\tvar b = true;\r\n\tthis.render = function () {\r\n\t\tb = false;\r\n\t\tif (this.array.length == 0) return;\r\n\t\tfor (var i = 0; i < this.array.length; i++) {\r\n\t\t\tif (this.array[i]._activ != false) {\r\n\t\t\t\tthis.array[i].render();\r\n\t\t\t\tb = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (b == true) this.composer.render();\r\n\r\n\t\treturn b;\r\n\r\n\r\n\t};\r\n\r\n\tthis.sizeWindow = function (_width, _height) {\r\n\t\tthis._width = _width;\r\n\t\tthis._height = _height;\r\n\t\tif (this.array.length == 0) return;\r\n\t\tthis.composer.setSize(this._width, this._height);\r\n\t\tfor (var i = 0; i < this.array.length; i++) {\r\n\t\t\tif (this.array[i].sizeWindow) this.array[i].sizeWindow(_width, _height);\r\n\t\t}\r\n\t};\r\n\tthis.clear = function (b) {\r\n\t\tif (b == undefined) this.composer.passes.length = 0;\r\n\t\tfor (var i = 0; i < this.array.length; i++) {\r\n\t\t\tif (b == undefined) this.array[i].activ = false;\r\n\t\t\tthis.array[i].effect.renderToScreen = false;\r\n\t\t\tthis.array[i].effect.unbiased = false;\r\n\t\t}\r\n\t};\r\n\r\n\r\n}\r\n\r\nMEffectArray.prototype = {\r\n\tset activ (v) {\r\n\t\tif (this._activ != v) {\r\n\t\t\tthis._activ = v;\r\n\t\t}\r\n\t},\r\n\tget activ () {\r\n\t\treturn this._activ;\r\n\t},\r\n\tset startArray (v) {\r\n\t\tthis._startArray = v;\r\n\t},\r\n\tget startArray () {\r\n\t\treturn this._startArray;\r\n\t},\r\n\r\n\r\n\tset renderPass (v) {\r\n\t\tif (this._renderPass != v) {\r\n\t\t\tthis._renderPass = v;\r\n\t\t\tthis.drawRender();\r\n\t\t}\r\n\t},\r\n\tget renderPass () {\r\n\t\treturn this._renderPass;\r\n\t},\r\n\r\n\r\n\tset outlinePass (v) {\r\n\t\tif (this._outlinePass != v) {\r\n\t\t\tthis._outlinePass = v;\r\n\t\t\tthis.drawRender();\r\n\t\t}\r\n\t},\r\n\tget outlinePass () {\r\n\t\treturn this._outlinePass;\r\n\t},\r\n\r\n\r\n\tset outlineColor (v) {\r\n\t\tif (this._outlineColor != v) {\r\n\t\t\tthis._outlineColor = v;\r\n\t\t\tthis.object['OutlinePass'].effect.visibleEdgeColor = new THREE.Color(this._outlineColor);\r\n\t\t\ttrace(this._outlineColor, '   ', this.object['OutlinePass'].effect.visibleEdgeColor);\r\n\r\n\t\t}\r\n\t},\r\n\tget outlineColor () {\r\n\t\treturn this._outlineColor;\r\n\t},\r\n\r\n\tset outlineColor1 (v) {\r\n\t\tif (this._outlineColor1 != v) {\r\n\t\t\tthis._outlineColor1 = v;\r\n\t\t\tthis.object['OutlinePass'].effect.hiddenEdgeColor = new THREE.Color(this._outlineColor1);\r\n\t\t}\r\n\t},\r\n\tget outlineColor1 () {\r\n\t\treturn this._outlineColor1;\r\n\t},\r\n\r\n\r\n\tset strJSON (v) {\r\n\t\tif (this._strJSON != v) {\r\n\t\t\tthis._strJSON = v;\r\n\t\t\tthis.setObjInObj(this.object['OutlinePass'].effect, this._strJSON);\r\n\t\t\t// this.dragOutline();\r\n\t\t}\r\n\t},\r\n\tget strJSON () {\r\n\t\treturn this._strJSON;\r\n\t},\r\n\r\n\r\n\tset taaPass (v) {\r\n\t\tif (this._taaPass != v) {\r\n\t\t\tthis._taaPass = v;\r\n\t\t\tthis.drawRender();\r\n\t\t}\r\n\t},\r\n\tget taaPass () {\r\n\t\treturn this._taaPass;\r\n\t},\r\n\r\n\tset sampleLevel (v) {\r\n\t\tif (this._sampleLevel != v) {\r\n\t\t\tthis._sampleLevel = v;\r\n\t\t\tthis.object['TAARenderPass'].effect.sampleLevel = this._sampleLevel;\r\n\t\t}\r\n\t},\r\n\tget sampleLevel () {\r\n\t\treturn this._sampleLevel;\r\n\t},\r\n\r\n\r\n\tset shaderPass (v) {\r\n\t\tif (this._shaderPass != v) {\r\n\t\t\tthis._shaderPass = v;\r\n\t\t\tthis.drawRender();\r\n\t\t}\r\n\t},\r\n\tget shaderPass () {\r\n\t\treturn this._shaderPass;\r\n\t},\r\n\r\n\r\n\tset saoPass (v) {\r\n\t\tif (this._saoPass != v) {\r\n\t\t\tthis._saoPass = v;\r\n\t\t\tthis.drawRender();\r\n\t\t}\r\n\t},\r\n\tget saoPass () {\r\n\t\treturn this._saoPass;\r\n\t},\r\n\r\n\r\n\tset saoJSON (v) {\r\n\t\tif (this._saoJSON != v) {\r\n\t\t\tthis._saoJSON = v;\r\n\t\t\tthis.setObjInObj(this.object['SAOPass'].effect.params, this._saoJSON);\r\n\t\t\t// this.dragOutline();\r\n\t\t}\r\n\t},\r\n\tget saoJSON () {\r\n\t\treturn this._saoJSON;\r\n\t}\r\n};\r\n\r\n\r\nfunction EffectScene (_effect) {\r\n\tvar self = this;\r\n\tthis.type = 'null';\r\n\tthis.effect = _effect;\r\n\r\n\tthis._activ = false;\r\n\tthis.render = function () {\r\n\r\n\t};\r\n}\r\n\r\nEffectScene.prototype = {\r\n\tset activ (v) {\r\n\t\tif (this._activ != v) {\r\n\t\t\tthis._activ = v;\r\n\t\t}\r\n\t},\r\n\tget activ () {\r\n\t\treturn this._activ;\r\n\t}\r\n\r\n\r\n};\r\n\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @authod mrdoob / http://mrdoob.com/\r\n * @authod arodic / http://aleksandarrodic.com/\r\n * @authod fonserbc / http://fonserbc.github.io/\r\n*/\r\n\r\nTHREE.StereoEffect = function (renderer) {\r\n\r\n\tvar _stereo = new THREE.StereoCamera();\r\n\t_stereo.aspect = 0.5;\r\n\r\n\tthis.setSize = function (width, height) {\r\n\r\n\t\trenderer.setSize(width, height);\r\n\r\n\t};\r\n\r\n\tthis.render = function (scene, camera) {\r\n\r\n\t\tscene.updateMatrixWorld();\r\n\r\n\t\tif (camera.parent === null) camera.updateMatrixWorld();\r\n\r\n\t\t_stereo.update(camera);\r\n\r\n\t\tvar size = renderer.getSize();\r\n\r\n\t\trenderer.setScissorTest(true);\r\n\t\trenderer.clear();\r\n\r\n\t\trenderer.setScissor(0, 0, size.width / 2, size.height);\r\n\t\trenderer.setViewport(0, 0, size.width / 2, size.height);\r\n\t\trenderer.render(scene, _stereo.cameraL);\r\n\r\n\t\trenderer.setScissor(size.width / 2, 0, size.width / 2, size.height);\r\n\t\trenderer.setViewport(size.width / 2, 0, size.width / 2, size.height);\r\n\t\trenderer.render(scene, _stereo.cameraR);\r\n\r\n\t\trenderer.setScissorTest(false);\r\n\r\n\t};\r\n\r\n};\r\n/**\r\n * Created by tpowellmeto on 29/10/2015.\r\n *\r\n * peppers ghost effect based on http://www.instructables.com/id/Reflective-Prism/?ALLSTEPS\r\n */\r\nTHREE.PeppersGhostEffect = function (renderer) {\r\n\r\n\tvar scope = this;\r\n\r\n\tscope.cameraDistance = 15;\r\n\tscope.reflectFromAbove = false;\r\n\r\n\t// Internals\r\n\tvar _halfWidth, _width, _height;\r\n\r\n\tvar _cameraF = new THREE.PerspectiveCamera(); // front\r\n\tvar _cameraB = new THREE.PerspectiveCamera(); // back\r\n\tvar _cameraL = new THREE.PerspectiveCamera(); // left\r\n\tvar _cameraR = new THREE.PerspectiveCamera(); // right\r\n\r\n\tvar _position = new THREE.Vector3();\r\n\tvar _quaternion = new THREE.Quaternion();\r\n\tvar _scale = new THREE.Vector3();\r\n\r\n\t// Initialization\r\n\trenderer.autoClear = false;\r\n\r\n\tthis.setSize = function (width, height) {\r\n\r\n\t\t_halfWidth = width / 2;\r\n\t\tif (width < height) {\r\n\r\n\t\t\t_width = width / 3;\r\n\t\t\t_height = width / 3;\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_width = height / 3;\r\n\t\t\t_height = height / 3;\r\n\r\n\t\t}\r\n\t\trenderer.setSize(width, height);\r\n\r\n\t};\r\n\r\n\tthis.render = function (scene, camera) {\r\n\r\n\t\tscene.updateMatrixWorld();\r\n\r\n\t\tif (camera.parent === null) camera.updateMatrixWorld();\r\n\r\n\t\tcamera.matrixWorld.decompose(_position, _quaternion, _scale);\r\n\r\n\t\t// front\r\n\t\t_cameraF.position.copy(_position);\r\n\t\t_cameraF.quaternion.copy(_quaternion);\r\n\t\t_cameraF.translateZ(scope.cameraDistance);\r\n\t\t_cameraF.lookAt(scene.position);\r\n\r\n\t\t// back\r\n\t\t_cameraB.position.copy(_position);\r\n\t\t_cameraB.quaternion.copy(_quaternion);\r\n\t\t_cameraB.translateZ(-(scope.cameraDistance));\r\n\t\t_cameraB.lookAt(scene.position);\r\n\t\t_cameraB.rotation.z += 180 * (Math.PI / 180);\r\n\r\n\t\t// left\r\n\t\t_cameraL.position.copy(_position);\r\n\t\t_cameraL.quaternion.copy(_quaternion);\r\n\t\t_cameraL.translateX(-(scope.cameraDistance));\r\n\t\t_cameraL.lookAt(scene.position);\r\n\t\t_cameraL.rotation.x += 90 * (Math.PI / 180);\r\n\r\n\t\t// right\r\n\t\t_cameraR.position.copy(_position);\r\n\t\t_cameraR.quaternion.copy(_quaternion);\r\n\t\t_cameraR.translateX(scope.cameraDistance);\r\n\t\t_cameraR.lookAt(scene.position);\r\n\t\t_cameraR.rotation.x += 90 * (Math.PI / 180);\r\n\r\n\r\n\t\trenderer.clear();\r\n\t\trenderer.setScissorTest(true);\r\n\r\n\t\trenderer.setScissor(_halfWidth - (_width / 2), (_height * 2), _width, _height);\r\n\t\trenderer.setViewport(_halfWidth - (_width / 2), (_height * 2), _width, _height);\r\n\r\n\t\tif (scope.reflectFromAbove) {\r\n\r\n\t\t\trenderer.render(scene, _cameraB);\r\n\r\n\t\t} else {\r\n\r\n\t\t\trenderer.render(scene, _cameraF);\r\n\r\n\t\t}\r\n\r\n\t\trenderer.setScissor(_halfWidth - (_width / 2), 0, _width, _height);\r\n\t\trenderer.setViewport(_halfWidth - (_width / 2), 0, _width, _height);\r\n\r\n\t\tif (scope.reflectFromAbove) {\r\n\r\n\t\t\trenderer.render(scene, _cameraF);\r\n\r\n\t\t} else {\r\n\r\n\t\t\trenderer.render(scene, _cameraB);\r\n\r\n\t\t}\r\n\r\n\t\trenderer.setScissor(_halfWidth - (_width / 2) - _width, _height, _width, _height);\r\n\t\trenderer.setViewport(_halfWidth - (_width / 2) - _width, _height, _width, _height);\r\n\r\n\t\tif (scope.reflectFromAbove) {\r\n\r\n\t\t\trenderer.render(scene, _cameraR);\r\n\r\n\t\t} else {\r\n\r\n\t\t\trenderer.render(scene, _cameraL);\r\n\r\n\t\t}\r\n\r\n\t\trenderer.setScissor(_halfWidth + (_width / 2), _height, _width, _height);\r\n\t\trenderer.setViewport(_halfWidth + (_width / 2), _height, _width, _height);\r\n\r\n\t\tif (scope.reflectFromAbove) {\r\n\r\n\t\t\trenderer.render(scene, _cameraL);\r\n\r\n\t\t} else {\r\n\r\n\t\t\trenderer.render(scene, _cameraR);\r\n\r\n\t\t}\r\n\r\n\t\trenderer.setScissorTest(false);\r\n\r\n\t};\r\n\r\n\r\n};\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author marklundin / http://mark-lundin.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\nTHREE.ParallaxBarrierEffect = function (renderer) {\r\n\r\n\tvar _camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);\r\n\r\n\tvar _scene = new THREE.Scene();\r\n\r\n\tvar _stereo = new THREE.StereoCamera();\r\n\r\n\tvar _params = { minFilter: THREE.LinearFilter, magFilter: THREE.NearestFilter, format: THREE.RGBAFormat };\r\n\r\n\tvar _renderTargetL = new THREE.WebGLRenderTarget(512, 512, _params);\r\n\tvar _renderTargetR = new THREE.WebGLRenderTarget(512, 512, _params);\r\n\r\n\tvar _material = new THREE.ShaderMaterial({\r\n\r\n\t\tuniforms: {\r\n\r\n\t\t\t'mapLeft': { type: 't', value: _renderTargetL.texture },\r\n\t\t\t'mapRight': { type: 't', value: _renderTargetR.texture }\r\n\r\n\t\t},\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t'varying vec2 vUv;',\r\n\r\n\t\t\t'void main() {',\r\n\r\n\t\t\t'\tvUv = vec2( uv.x, uv.y );',\r\n\t\t\t'\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\r\n\r\n\t\t\t'}'\r\n\r\n\t\t].join('\\n'),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t'uniform sampler2D mapLeft;',\r\n\t\t\t'uniform sampler2D mapRight;',\r\n\t\t\t'varying vec2 vUv;',\r\n\r\n\t\t\t'void main() {',\r\n\r\n\t\t\t'\tvec2 uv = vUv;',\r\n\r\n\t\t\t'\tif ( ( mod( gl_FragCoord.y, 2.0 ) ) > 1.00 ) {',\r\n\r\n\t\t\t'\t\tgl_FragColor = texture2D( mapLeft, uv );',\r\n\r\n\t\t\t'\t} else {',\r\n\r\n\t\t\t'\t\tgl_FragColor = texture2D( mapRight, uv );',\r\n\r\n\t\t\t'\t}',\r\n\r\n\t\t\t'}'\r\n\r\n\t\t].join('\\n')\r\n\r\n\t});\r\n\r\n\tvar mesh = new THREE.Mesh(new THREE.PlaneBufferGeometry(2, 2), _material);\r\n\t_scene.add(mesh);\r\n\r\n\tthis.setSize = function (width, height) {\r\n\r\n\t\trenderer.setSize(width, height);\r\n\r\n\t\tvar pixelRatio = renderer.getPixelRatio();\r\n\r\n\t\t_renderTargetL.setSize(width * pixelRatio, height * pixelRatio);\r\n\t\t_renderTargetR.setSize(width * pixelRatio, height * pixelRatio);\r\n\r\n\t};\r\n\r\n\tthis.render = function (scene, camera) {\r\n\r\n\t\tscene.updateMatrixWorld();\r\n\r\n\t\tif (camera.parent === null) camera.updateMatrixWorld();\r\n\r\n\t\t_stereo.update(camera);\r\n\r\n\t\trenderer.render(scene, _stereo.cameraL, _renderTargetL, true);\r\n\t\trenderer.render(scene, _stereo.cameraR, _renderTargetR, true);\r\n\t\trenderer.render(_scene, _camera);\r\n\r\n\t};\r\n\r\n};\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author marklundin / http://mark-lundin.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author tschw\r\n */\r\nTHREE.AnaglyphEffect = function (renderer, width, height) {\r\n\r\n\t// Matrices generated with angler.js https://github.com/tschw/angler.js/\r\n\t// (in column-major element order, as accepted by WebGL)\r\n\r\n\tthis.colorMatrixLeft = new THREE.Matrix3().fromArray([\r\n\r\n\t\t1.0671679973602295, \t-0.0016435992438346148,\t\t 0.0001777536963345483, // r out\r\n\t\t-0.028107794001698494,\t-0.00019593400065787137,\t-0.0002875397040043026, // g out\r\n\t\t-0.04279090091586113,\t 0.000015809757314855233,\t-0.00024287120322696865 // b out\r\n\r\n\t]);\r\n\r\n\t//\t\tred\t\t\t\t\t\tgreen \t\t\t\t\t\tblue  \t\t\t\t\t\tin\r\n\r\n\tthis.colorMatrixRight = new THREE.Matrix3().fromArray([\r\n\r\n\t\t-0.0355340838432312,\t-0.06440307199954987,\t\t 0.018319187685847282,\t// r out\r\n\t\t-0.10269022732973099,\t 0.8079727292060852,\t\t-0.04835830628871918,\t// g out\r\n\t\t0.0001224992738571018,\t-0.009558862075209618,\t\t 0.567823588848114\t\t// b out\r\n\r\n\t]);\r\n\r\n\tvar _camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);\r\n\r\n\tvar _scene = new THREE.Scene();\r\n\r\n\tvar _stereo = new THREE.StereoCamera();\r\n\r\n\tvar _params = { minFilter: THREE.LinearFilter, magFilter: THREE.NearestFilter, format: THREE.RGBAFormat };\r\n\r\n\tif (width === undefined) width = 512;\r\n\tif (height === undefined) height = 512;\r\n\r\n\tvar _renderTargetL = new THREE.WebGLRenderTarget(width, height, _params);\r\n\tvar _renderTargetR = new THREE.WebGLRenderTarget(width, height, _params);\r\n\r\n\tvar _material = new THREE.ShaderMaterial({\r\n\r\n\t\tuniforms: {\r\n\r\n\t\t\t'mapLeft': { type: 't', value: _renderTargetL.texture },\r\n\t\t\t'mapRight': { type: 't', value: _renderTargetR.texture },\r\n\r\n\t\t\t'colorMatrixLeft': { type: 'm3', value: this.colorMatrixLeft },\r\n\t\t\t'colorMatrixRight': { type: 'm3', value: this.colorMatrixRight }\r\n\r\n\t\t},\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t'varying vec2 vUv;',\r\n\r\n\t\t\t'void main() {',\r\n\r\n\t\t\t'\tvUv = vec2( uv.x, uv.y );',\r\n\t\t\t'\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\r\n\r\n\t\t\t'}'\r\n\r\n\t\t].join('\\n'),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t'uniform sampler2D mapLeft;',\r\n\t\t\t'uniform sampler2D mapRight;',\r\n\t\t\t'varying vec2 vUv;',\r\n\r\n\t\t\t'uniform mat3 colorMatrixLeft;',\r\n\t\t\t'uniform mat3 colorMatrixRight;',\r\n\r\n\t\t\t// These functions implement sRGB linearization and gamma correction\r\n\r\n\t\t\t'float lin( float c ) {',\r\n\t\t\t'\treturn c <= 0.04045 ? c * 0.0773993808 :',\r\n\t\t\t'\t\t\tpow( c * 0.9478672986 + 0.0521327014, 2.4 );',\r\n\t\t\t'}',\r\n\r\n\t\t\t'vec4 lin( vec4 c ) {',\r\n\t\t\t'\treturn vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );',\r\n\t\t\t'}',\r\n\r\n\t\t\t'float dev( float c ) {',\r\n\t\t\t'\treturn c <= 0.0031308 ? c * 12.92',\r\n\t\t\t'\t\t\t: pow( c, 0.41666 ) * 1.055 - 0.055;',\r\n\t\t\t'}',\r\n\r\n\r\n\t\t\t'void main() {',\r\n\r\n\t\t\t'\tvec2 uv = vUv;',\r\n\r\n\t\t\t'\tvec4 colorL = lin( texture2D( mapLeft, uv ) );',\r\n\t\t\t'\tvec4 colorR = lin( texture2D( mapRight, uv ) );',\r\n\r\n\t\t\t'\tvec3 color = clamp(',\r\n\t\t\t'\t\t\tcolorMatrixLeft * colorL.rgb +',\r\n\t\t\t'\t\t\tcolorMatrixRight * colorR.rgb, 0., 1. );',\r\n\r\n\t\t\t'\tgl_FragColor = vec4(',\r\n\t\t\t'\t\t\tdev( color.r ), dev( color.g ), dev( color.b ),',\r\n\t\t\t'\t\t\tmax( colorL.a, colorR.a ) );',\r\n\r\n\t\t\t'}'\r\n\r\n\t\t].join('\\n')\r\n\r\n\t});\r\n\r\n\tvar mesh = new THREE.Mesh(new THREE.PlaneBufferGeometry(2, 2), _material);\r\n\t_scene.add(mesh);\r\n\r\n\tthis.setSize = function (width, height) {\r\n\r\n\t\trenderer.setSize(width, height);\r\n\r\n\t\tvar pixelRatio = renderer.getPixelRatio();\r\n\r\n\t\t_renderTargetL.setSize(width * pixelRatio, height * pixelRatio);\r\n\t\t_renderTargetR.setSize(width * pixelRatio, height * pixelRatio);\r\n\r\n\t};\r\n\r\n\tthis.render = function (scene, camera) {\r\n\r\n\t\tscene.updateMatrixWorld();\r\n\r\n\t\tif (camera.parent === null) camera.updateMatrixWorld();\r\n\r\n\t\t_stereo.update(camera);\r\n\r\n\t\trenderer.render(scene, _stereo.cameraL, _renderTargetL, true);\r\n\t\trenderer.render(scene, _stereo.cameraR, _renderTargetR, true);\r\n\t\trenderer.render(_scene, _camera);\r\n\r\n\t};\r\n\r\n\tthis.dispose = function () {\r\n\r\n\t\tif (_renderTargetL) _renderTargetL.dispose();\r\n\t\tif (_renderTargetR) _renderTargetR.dispose();\r\n\r\n\t};\r\n\r\n};\r\n\r\n\r\n/*\r\n * @author zz85 / https://github.com/zz85\r\n *\r\n * Ascii generation is based on http://www.nihilogic.dk/labs/jsascii/\r\n * Maybe more about this later with a blog post at http://lab4games.net/zz85/blog\r\n *\r\n * 16 April 2012 - @blurspline\r\n */\r\n\r\nTHREE.AsciiEffect = function (renderer, charSet, options) {\r\n\r\n\t// its fun to create one your own!\r\n\r\n\tcharSet = (charSet === undefined) ? ' .:-=+*#%@' : charSet;\r\n\r\n\t// ' .,:;=|iI+hHOE#`$';\r\n\t// darker bolder character set from https://github.com/saw/Canvas-ASCII-Art/\r\n\t// ' .\\'`^\",:;Il!i~+_-?][}{1)(|/tfjrxnuvczXYUJCLQ0OZmwqpdbkhao*#MW&8%B@$'.split('');\r\n\r\n\tif (!options) options = {};\r\n\r\n\t// Some ASCII settings\r\n\r\n\tvar bResolution = !options[ 'resolution' ] ? 0.15 : options[ 'resolution' ]; // Higher for more details\r\n\tvar iScale = !options[ 'scale' ] ? 1 : options[ 'scale' ];\r\n\tvar bColor = !options[ 'color' ] ? false : options[ 'color' ]; // nice but slows down rendering!\r\n\tvar bAlpha = !options[ 'alpha' ] ? false : options[ 'alpha' ]; // Transparency\r\n\tvar bBlock = !options[ 'block' ] ? false : options[ 'block' ]; // blocked characters. like good O dos\r\n\tvar bInvert = !options[ 'invert' ] ? false : options[ 'invert' ]; // black is white, white is black\r\n\r\n\tvar strResolution = 'low';\r\n\r\n\tvar width, height;\r\n\r\n\tvar domElement = document.createElement('div');\r\n\tdomElement.style.cursor = 'default';\r\n\r\n\tvar oAscii = document.createElement('table');\r\n\tdomElement.appendChild(oAscii);\r\n\r\n\tvar iWidth, iHeight;\r\n\tvar oImg;\r\n\r\n\tthis.setSize = function (w, h) {\r\n\r\n\t\twidth = w;\r\n\t\theight = h;\r\n\r\n\t\trenderer.setSize(w, h);\r\n\r\n\t\tinitAsciiSize();\r\n\r\n\t};\r\n\r\n\r\n\tthis.render = function (scene, camera) {\r\n\r\n\t\trenderer.render(scene, camera);\r\n\t\tasciifyImage(renderer, oAscii);\r\n\r\n\t};\r\n\r\n\tthis.domElement = domElement;\r\n\r\n\r\n\t// Throw in ascii library from http://www.nihilogic.dk/labs/jsascii/jsascii.js\r\n\r\n\t/*\r\n\t* jsAscii 0.1\r\n\t* Copyright (c) 2008 Jacob Seidelin, jseidelin@nihilogic.dk, http://blog.nihilogic.dk/\r\n\t* MIT License [http://www.nihilogic.dk/licenses/mit-license.txt]\r\n\t*/\r\n\r\n\tfunction initAsciiSize () {\r\n\r\n\t\tiWidth = Math.round(width * fResolution);\r\n\t\tiHeight = Math.round(height * fResolution);\r\n\r\n\t\toCanvas.width = iWidth;\r\n\t\toCanvas.height = iHeight;\r\n\t\t// oCanvas.style.display = \"none\";\r\n\t\t// oCanvas.style.width = iWidth;\r\n\t\t// oCanvas.style.height = iHeight;\r\n\r\n\t\toImg = renderer.domElement;\r\n\r\n\t\tif (oImg.style.backgroundColor) {\r\n\r\n\t\t\toAscii.rows[ 0 ].cells[ 0 ].style.backgroundColor = oImg.style.backgroundColor;\r\n\t\t\toAscii.rows[ 0 ].cells[ 0 ].style.color = oImg.style.color;\r\n\r\n\t\t}\r\n\r\n\t\toAscii.cellSpacing = 0;\r\n\t\toAscii.cellPadding = 0;\r\n\r\n\t\tvar oStyle = oAscii.style;\r\n\t\toStyle.display = 'inline';\r\n\t\toStyle.width = Math.round(iWidth / fResolution * iScale) + 'px';\r\n\t\toStyle.height = Math.round(iHeight / fResolution * iScale) + 'px';\r\n\t\toStyle.whiteSpace = 'pre';\r\n\t\toStyle.margin = '0px';\r\n\t\toStyle.padding = '0px';\r\n\t\toStyle.letterSpacing = fLetterSpacing + 'px';\r\n\t\toStyle.fontFamily = strFont;\r\n\t\toStyle.fontSize = fFontSize + 'px';\r\n\t\toStyle.lineHeight = fLineHeight + 'px';\r\n\t\toStyle.textAlign = 'left';\r\n\t\toStyle.textDecoration = 'none';\r\n\r\n\t}\r\n\r\n\r\n\tvar aDefaultCharList = (' .,:;i1tfLCG08@').split('');\r\n\tvar aDefaultColorCharList = (' CGO08@').split('');\r\n\tvar strFont = 'courier new, monospace';\r\n\r\n\tvar oCanvasImg = renderer.domElement;\r\n\r\n\tvar oCanvas = document.createElement('canvas');\r\n\tif (!oCanvas.getContext) {\r\n\r\n\t\treturn;\r\n\r\n\t}\r\n\r\n\tvar oCtx = oCanvas.getContext('2d');\r\n\tif (!oCtx.getImageData) {\r\n\r\n\t\treturn;\r\n\r\n\t}\r\n\r\n\tvar aCharList = (bColor ? aDefaultColorCharList : aDefaultCharList);\r\n\r\n\tif (charSet) aCharList = charSet;\r\n\r\n\tvar fResolution = 0.5;\r\n\r\n\tswitch (strResolution) {\r\n\r\n\t\tcase 'low' : \tfResolution = 0.25; break;\r\n\t\tcase 'medium' : fResolution = 0.5; break;\r\n\t\tcase 'high' : \tfResolution = 1; break;\r\n\r\n\t}\r\n\r\n\tif (bResolution) fResolution = bResolution;\r\n\r\n\t// Setup dom\r\n\r\n\tvar fFontSize = (2 / fResolution) * iScale;\r\n\tvar fLineHeight = (2 / fResolution) * iScale;\r\n\r\n\t// adjust letter-spacing for all combinations of scale and resolution to get it to fit the image width.\r\n\r\n\tvar fLetterSpacing = 0;\r\n\r\n\tif (strResolution == 'low') {\r\n\r\n\t\tswitch (iScale) {\r\n\t\t\tcase 1 : fLetterSpacing = -1; break;\r\n\t\t\tcase 2 :\r\n\t\t\tcase 3 : fLetterSpacing = -2.1; break;\r\n\t\t\tcase 4 : fLetterSpacing = -3.1; break;\r\n\t\t\tcase 5 : fLetterSpacing = -4.15; break;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tif (strResolution == 'medium') {\r\n\r\n\t\tswitch (iScale) {\r\n\t\t\tcase 1 : fLetterSpacing = 0; break;\r\n\t\t\tcase 2 : fLetterSpacing = -1; break;\r\n\t\t\tcase 3 : fLetterSpacing = -1.04; break;\r\n\t\t\tcase 4 :\r\n\t\t\tcase 5 : fLetterSpacing = -2.1; break;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tif (strResolution == 'high') {\r\n\r\n\t\tswitch (iScale) {\r\n\t\t\tcase 1 :\r\n\t\t\tcase 2 : fLetterSpacing = 0; break;\r\n\t\t\tcase 3 :\r\n\t\t\tcase 4 :\r\n\t\t\tcase 5 : fLetterSpacing = -1; break;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\t// can't get a span or div to flow like an img element, but a table works?\r\n\r\n\r\n\t// convert img element to ascii\r\n\r\n\tfunction asciifyImage (canvasRenderer, oAscii) {\r\n\r\n\t\toCtx.clearRect(0, 0, iWidth, iHeight);\r\n\t\toCtx.drawImage(oCanvasImg, 0, 0, iWidth, iHeight);\r\n\t\tvar oImgData = oCtx.getImageData(0, 0, iWidth, iHeight).data;\r\n\r\n\t\t// Coloring loop starts now\r\n\t\tvar strChars = '';\r\n\r\n\t\t// console.time('rendering');\r\n\r\n\t\tfor (var y = 0; y < iHeight; y += 2) {\r\n\r\n\t\t\tfor (var x = 0; x < iWidth; x++) {\r\n\r\n\t\t\t\tvar iOffset = (y * iWidth + x) * 4;\r\n\r\n\t\t\t\tvar iRed = oImgData[ iOffset ];\r\n\t\t\t\tvar iGreen = oImgData[ iOffset + 1 ];\r\n\t\t\t\tvar iBlue = oImgData[ iOffset + 2 ];\r\n\t\t\t\tvar iAlpha = oImgData[ iOffset + 3 ];\r\n\t\t\t\tvar iCharIdx;\r\n\r\n\t\t\t\tvar fBrightness;\r\n\r\n\t\t\t\tfBrightness = (0.3 * iRed + 0.59 * iGreen + 0.11 * iBlue) / 255;\r\n\t\t\t\t// fBrightness = (0.3*iRed + 0.5*iGreen + 0.3*iBlue) / 255;\r\n\r\n\t\t\t\tif (iAlpha == 0) {\r\n\r\n\t\t\t\t\t// should calculate alpha instead, but quick hack :)\r\n\t\t\t\t\t// fBrightness *= (iAlpha / 255);\r\n\t\t\t\t\tfBrightness = 1;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tiCharIdx = Math.floor((1 - fBrightness) * (aCharList.length - 1));\r\n\r\n\t\t\t\tif (bInvert) {\r\n\r\n\t\t\t\t\tiCharIdx = aCharList.length - iCharIdx - 1;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// good for debugging\r\n\t\t\t\t// fBrightness = Math.floor(fBrightness * 10);\r\n\t\t\t\t// strThisChar = fBrightness;\r\n\r\n\t\t\t\tvar strThisChar = aCharList[ iCharIdx ];\r\n\r\n\t\t\t\tif (strThisChar === undefined || strThisChar == ' ') { strThisChar = '&nbsp;'; }\r\n\r\n\t\t\t\tif (bColor) {\r\n\r\n\t\t\t\t\tstrChars += \"<span style='\" +\r\n\t\t\t\t\t\t'color:rgb(' + iRed + ',' + iGreen + ',' + iBlue + ');' +\r\n\t\t\t\t\t\t(bBlock ? 'background-color:rgb(' + iRed + ',' + iGreen + ',' + iBlue + ');' : '') +\r\n\t\t\t\t\t\t(bAlpha ? 'opacity:' + (iAlpha / 255) + ';' : '') +\r\n\t\t\t\t\t\t\"'>\" + strThisChar + '</span>';\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tstrChars += strThisChar;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tstrChars += '<br/>';\r\n\r\n\t\t}\r\n\r\n\t\toAscii.innerHTML = '<tr><td>' + strChars + '</td></tr>';\r\n\r\n\t\t// console.timeEnd('rendering');\r\n\r\n\t\t// return oAscii;\r\n\r\n\t}\r\n\r\n\t// end modified asciifyImage block\r\n\r\n};\r\n\r\n\r\n/**\r\n*\r\n* Supersample Anti-Aliasing Render Pass\r\n*\r\n* @author bhouston / http://clara.io/\r\n*\r\n* This manual approach to SSAA re-renders the scene ones for each sample with camera jitter and accumulates the results.\r\n*\r\n* References: https://en.wikipedia.org/wiki/Supersampling\r\n*\r\n*/\r\n\r\nTHREE.SSAARenderPass = function (scene, camera, clearColor, clearAlpha) {\r\n\r\n\tTHREE.Pass.call(this);\r\n\r\n\tthis.scene = scene;\r\n\tthis.camera = camera;\r\n\r\n\tthis.sampleLevel = 4; // specified as n, where the number of samples is 2^n, so sampleLevel = 4, is 2^4 samples, 16.\r\n\tthis.unbiased = true;\r\n\r\n\t// as we need to clear the buffer in this pass, clearColor must be set to something, defaults to black.\r\n\tthis.clearColor = (clearColor !== undefined) ? clearColor : 0x000000;\r\n\tthis.clearAlpha = (clearAlpha !== undefined) ? clearAlpha : 0;\r\n\r\n\tif (THREE.CopyShader === undefined) console.error('THREE.SSAARenderPass relies on THREE.CopyShader');\r\n\r\n\tvar copyShader = THREE.CopyShader;\r\n\tthis.copyUniforms = THREE.UniformsUtils.clone(copyShader.uniforms);\r\n\r\n\tthis.copyMaterial = new THREE.ShaderMaterial({\r\n\t\tuniforms: this.copyUniforms,\r\n\t\tvertexShader: copyShader.vertexShader,\r\n\t\tfragmentShader: copyShader.fragmentShader,\r\n\t\tpremultipliedAlpha: true,\r\n\t\ttransparent: true,\r\n\t\tblending: THREE.AdditiveBlending,\r\n\t\tdepthTest: false,\r\n\t\tdepthWrite: false\r\n\t});\r\n\r\n\tthis.camera2 = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);\r\n\tthis.scene2\t= new THREE.Scene();\r\n\tthis.quad2 = new THREE.Mesh(new THREE.PlaneBufferGeometry(2, 2), this.copyMaterial);\r\n\tthis.quad2.frustumCulled = false; // Avoid getting clipped\r\n\tthis.scene2.add(this.quad2);\r\n\r\n};\r\n\r\nTHREE.SSAARenderPass.prototype = Object.assign(Object.create(THREE.Pass.prototype), {\r\n\r\n\tconstructor: THREE.SSAARenderPass,\r\n\r\n\tdispose: function () {\r\n\r\n\t\tif (this.sampleRenderTarget) {\r\n\r\n\t\t\tthis.sampleRenderTarget.dispose();\r\n\t\t\tthis.sampleRenderTarget = null;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tsetSize: function (width, height) {\r\n\r\n\t\tif (this.sampleRenderTarget)\tthis.sampleRenderTarget.setSize(width, height);\r\n\r\n\t},\r\n\r\n\trender: function (renderer, writeBuffer, readBuffer) {\r\n\r\n\t\tif (!this.sampleRenderTarget) {\r\n\r\n\t\t\tthis.sampleRenderTarget = new THREE.WebGLRenderTarget(readBuffer.width, readBuffer.height, { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBAFormat });\r\n\t\t\tthis.sampleRenderTarget.texture.name = 'SSAARenderPass.sample';\r\n\r\n\t\t}\r\n\r\n\t\tvar jitterOffsets = THREE.SSAARenderPass.JitterVectors[ Math.max(0, Math.min(this.sampleLevel, 5)) ];\r\n\r\n\t\tvar autoClear = renderer.autoClear;\r\n\t\trenderer.autoClear = false;\r\n\r\n\t\tvar oldClearColor = renderer.getClearColor().getHex();\r\n\t\tvar oldClearAlpha = renderer.getClearAlpha();\r\n\r\n\t\tvar baseSampleWeight = 1.0 / jitterOffsets.length;\r\n\t\tvar roundingRange = 1 / 32;\r\n\t\tthis.copyUniforms[ 'tDiffuse' ].value = this.sampleRenderTarget.texture;\r\n\r\n\t\tvar width = readBuffer.width; var height = readBuffer.height;\r\n\r\n\t\t// render the scene multiple times, each slightly jitter offset from the last and accumulate the results.\r\n\t\tfor (var i = 0; i < jitterOffsets.length; i++) {\r\n\r\n\t\t\tvar jitterOffset = jitterOffsets[ i ];\r\n\r\n\t\t\tif (this.camera.setViewOffset) {\r\n\r\n\t\t\t\tthis.camera.setViewOffset(width, height,\r\n\t\t\t\t\tjitterOffset[ 0 ] * 0.0625, jitterOffset[ 1 ] * 0.0625, // 0.0625 = 1 / 16\r\n\t\t\t\t\twidth, height);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar sampleWeight = baseSampleWeight;\r\n\r\n\t\t\tif (this.unbiased) {\r\n\r\n\t\t\t\t// the theory is that equal weights for each sample lead to an accumulation of rounding errors.\r\n\t\t\t\t// The following equation varies the sampleWeight per sample so that it is uniformly distributed\r\n\t\t\t\t// across a range of values whose rounding errors cancel each other out.\r\n\r\n\t\t\t\tvar uniformCenteredDistribution = (-0.5 + (i + 0.5) / jitterOffsets.length);\r\n\t\t\t\tsampleWeight += roundingRange * uniformCenteredDistribution;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.copyUniforms[ 'opacity' ].value = sampleWeight;\r\n\t\t\trenderer.setClearColor(this.clearColor, this.clearAlpha);\r\n\t\t\trenderer.render(this.scene, this.camera, this.sampleRenderTarget, true);\r\n\r\n\t\t\tif (i === 0) {\r\n\r\n\t\t\t\trenderer.setClearColor(0x000000, 0.0);\r\n\r\n\t\t\t}\r\n\r\n\t\t\trenderer.render(this.scene2, this.camera2, this.renderToScreen ? null : writeBuffer, (i === 0));\r\n\r\n\t\t}\r\n\r\n\t\tif (this.camera.clearViewOffset) this.camera.clearViewOffset();\r\n\r\n\t\trenderer.autoClear = autoClear;\r\n\t\trenderer.setClearColor(oldClearColor, oldClearAlpha);\r\n\r\n\t}\r\n\r\n});\r\n\r\n\r\n// These jitter vectors are specified in integers because it is easier.\r\n// I am assuming a [-8,8) integer grid, but it needs to be mapped onto [-0.5,0.5)\r\n// before being used, thus these integers need to be scaled by 1/16.\r\n//\r\n// Sample patterns reference: https://msdn.microsoft.com/en-us/library/windows/desktop/ff476218%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396\r\nTHREE.SSAARenderPass.JitterVectors = [\r\n\t[\r\n\t\t[ 0, 0 ]\r\n\t],\r\n\t[\r\n\t\t[ 4, 4 ], [ -4, -4 ]\r\n\t],\r\n\t[\r\n\t\t[ -2, -6 ], [ 6, -2 ], [ -6, 2 ], [ 2, 6 ]\r\n\t],\r\n\t[\r\n\t\t[ 1, -3 ], [ -1, 3 ], [ 5, 1 ], [ -3, -5 ],\r\n\t\t[ -5, 5 ], [ -7, -1 ], [ 3, 7 ], [ 7, -7 ]\r\n\t],\r\n\t[\r\n\t\t[ 1, 1 ], [ -1, -3 ], [ -3, 2 ], [ 4, -1 ],\r\n\t\t[ -5, -2 ], [ 2, 5 ], [ 5, 3 ], [ 3, -5 ],\r\n\t\t[ -2, 6 ], [ 0, -7 ], [ -4, -6 ], [ -6, 4 ],\r\n\t\t[ -8, 0 ], [ 7, -4 ], [ 6, 7 ], [ -7, -8 ]\r\n\t],\r\n\t[\r\n\t\t[ -4, -7 ], [ -7, -5 ], [ -3, -5 ], [ -5, -4 ],\r\n\t\t[ -1, -4 ], [ -2, -2 ], [ -6, -1 ], [ -4, 0 ],\r\n\t\t[ -7, 1 ], [ -1, 2 ], [ -6, 3 ], [ -3, 3 ],\r\n\t\t[ -7, 6 ], [ -3, 6 ], [ -5, 7 ], [ -1, 7 ],\r\n\t\t[ 5, -7 ], [ 1, -6 ], [ 6, -5 ], [ 4, -4 ],\r\n\t\t[ 2, -3 ], [ 7, -2 ], [ 1, -1 ], [ 4, -1 ],\r\n\t\t[ 2, 1 ], [ 6, 2 ], [ 0, 4 ], [ 4, 4 ],\r\n\t\t[ 2, 5 ], [ 7, 5 ], [ 5, 6 ], [ 3, 7 ]\r\n\t]\r\n];\r\n\r\n/**\r\n *\r\n * Temporal Anti-Aliasing Render Pass\r\n *\r\n * @author bhouston / http://clara.io/\r\n *\r\n * When there is no motion in the scene, the TAA render pass accumulates jittered camera samples across frames to create a high quality anti-aliased result.\r\n *\r\n * References:\r\n *\r\n * TODO: Add support for motion vector pas so that accumulation of samples across frames can occur on dynamics scenes.\r\n *\r\n */\r\n\r\nTHREE.TAARenderPass = function (scene, camera, params) {\r\n\r\n\tif (THREE.SSAARenderPass === undefined) {\r\n\r\n\t\tconsole.error('THREE.TAARenderPass relies on THREE.SSAARenderPass');\r\n\r\n\t}\r\n\r\n\tTHREE.SSAARenderPass.call(this, scene, camera, params);\r\n\r\n\tthis.sampleLevel = 0;\r\n\tthis.accumulate = false;\r\n\r\n};\r\n\r\nTHREE.TAARenderPass.JitterVectors = THREE.SSAARenderPass.JitterVectors;\r\n\r\nTHREE.TAARenderPass.prototype = Object.assign(Object.create(THREE.SSAARenderPass.prototype), {\r\n\r\n\tconstructor: THREE.TAARenderPass,\r\n\r\n\trender: function (renderer, writeBuffer, readBuffer, delta) {\r\n\r\n\t\tif (!this.accumulate) {\r\n\r\n\t\t\tTHREE.SSAARenderPass.prototype.render.call(this, renderer, writeBuffer, readBuffer, delta);\r\n\r\n\t\t\tthis.accumulateIndex = -1;\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar jitterOffsets = THREE.TAARenderPass.JitterVectors[ 5 ];\r\n\r\n\t\tif (!this.sampleRenderTarget) {\r\n\r\n\t\t\tthis.sampleRenderTarget = new THREE.WebGLRenderTarget(readBuffer.width, readBuffer.height, this.params);\r\n\t\t\tthis.sampleRenderTarget.texture.name = 'TAARenderPass.sample';\r\n\r\n\t\t}\r\n\r\n\t\tif (!this.holdRenderTarget) {\r\n\r\n\t\t\tthis.holdRenderTarget = new THREE.WebGLRenderTarget(readBuffer.width, readBuffer.height, this.params);\r\n\t\t\tthis.holdRenderTarget.texture.name = 'TAARenderPass.hold';\r\n\r\n\t\t}\r\n\r\n\t\tif (this.accumulate && this.accumulateIndex === -1) {\r\n\r\n\t\t\tTHREE.SSAARenderPass.prototype.render.call(this, renderer, this.holdRenderTarget, readBuffer, delta);\r\n\r\n\t\t\tthis.accumulateIndex = 0;\r\n\r\n\t\t}\r\n\r\n\t\tvar autoClear = renderer.autoClear;\r\n\t\trenderer.autoClear = false;\r\n\r\n\t\tvar sampleWeight = 1.0 / (jitterOffsets.length);\r\n\r\n\t\tif (this.accumulateIndex >= 0 && this.accumulateIndex < jitterOffsets.length) {\r\n\r\n\t\t\tthis.copyUniforms[ 'opacity' ].value = sampleWeight;\r\n\t\t\tthis.copyUniforms[ 'tDiffuse' ].value = writeBuffer.texture;\r\n\r\n\t\t\t// render the scene multiple times, each slightly jitter offset from the last and accumulate the results.\r\n\t\t\tvar numSamplesPerFrame = Math.pow(2, this.sampleLevel);\r\n\t\t\tfor (var i = 0; i < numSamplesPerFrame; i++) {\r\n\r\n\t\t\t\tvar j = this.accumulateIndex;\r\n\t\t\t\tvar jitterOffset = jitterOffsets[ j ];\r\n\r\n\t\t\t\tif (this.camera.setViewOffset) {\r\n\r\n\t\t\t\t\tthis.camera.setViewOffset(readBuffer.width, readBuffer.height,\r\n\t\t\t\t\t\tjitterOffset[ 0 ] * 0.0625, jitterOffset[ 1 ] * 0.0625, // 0.0625 = 1 / 16\r\n\t\t\t\t\t\treadBuffer.width, readBuffer.height);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\trenderer.render(this.scene, this.camera, writeBuffer, true);\r\n\t\t\t\trenderer.render(this.scene2, this.camera2, this.sampleRenderTarget, (this.accumulateIndex === 0));\r\n\r\n\t\t\t\tthis.accumulateIndex++;\r\n\r\n\t\t\t\tif (this.accumulateIndex >= jitterOffsets.length) break;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (this.camera.clearViewOffset) this.camera.clearViewOffset();\r\n\r\n\t\t}\r\n\r\n\t\tvar accumulationWeight = this.accumulateIndex * sampleWeight;\r\n\r\n\t\tif (accumulationWeight > 0) {\r\n\r\n\t\t\tthis.copyUniforms[ 'opacity' ].value = 1.0;\r\n\t\t\tthis.copyUniforms[ 'tDiffuse' ].value = this.sampleRenderTarget.texture;\r\n\t\t\trenderer.render(this.scene2, this.camera2, writeBuffer, true);\r\n\r\n\t\t}\r\n\r\n\t\tif (accumulationWeight < 1.0) {\r\n\r\n\t\t\tthis.copyUniforms[ 'opacity' ].value = 1.0 - accumulationWeight;\r\n\t\t\tthis.copyUniforms[ 'tDiffuse' ].value = this.holdRenderTarget.texture;\r\n\t\t\trenderer.render(this.scene2, this.camera2, writeBuffer, (accumulationWeight === 0));\r\n\r\n\t\t}\r\n\r\n\t\trenderer.autoClear = autoClear;\r\n\r\n\t}\r\n\r\n});\r\n","import MUtility from './MUtility.js';\r\nimport MSky from './MSky.js';\r\nimport MSmc from './MSmc.js';\r\n\r\nexport default function MPosition3d (_parent, _content2d) {\r\n\tvar self = this;\r\n\r\n\tthis.parent = _parent;\r\n\tthis.content2d = _content2d;\r\n\tthis.drag = true;\r\n\tthis.zdvigX = 0;\r\n\tthis.sPixi = undefined;\r\n\r\n\tthis.pause = false;\r\n\tthis.minMaxX = new THREE.Vector2(0, 2.5);\r\n\r\n\tthis.zume = new THREE.Vector3(1, 30, 10);\r\n\r\n\tthis.point = new THREE.Vector2(0, 0);\r\n\tthis.point1 = new THREE.Vector2(0, 0);\r\n\tthis.b = 0;\r\n\r\n\tthis.minZum = 0;\r\n\tthis.maxZum = 5000;\r\n\tthis.powerZum = 5;\r\n\r\n\tthis.distMinMaxBox = 500;\r\n\r\n\r\n\tthis.isDragPan = _parent._isDragPan;\r\n\tthis.isRotateScene = false;\r\n\r\n\tvar sceneRotationY = 0;\r\n\r\n\r\n\tthis.getStage = function (c) {\r\n\t\tif (c.parent == undefined) return c;\r\n\t\telse return this.getStage(c.parent);\r\n\t\treturn null;\r\n\t};\r\n\r\n\r\n\tthis.stageMoveNew = function (e) {\r\n\r\n\t\tif (self.pause == true) return;\r\n\t\tif (self.drag == false) return;\r\n\r\n\t\tif (e.data && self.isDragPan && isMovePan) {\r\n\t\t\thandleMouseMovePan(e.data.originalEvent);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (e.data && self.isRotateScene && e.data.originalEvent.shiftKey) {\r\n\t\t\tself.parent.scene.rotation.y = sceneRotationY + (pl102.global.x - self.point1.x) * 0.01;\r\n\t\t\tself.parent.intRend = 1;\r\n\t\t} else {\r\n\r\n\t\t\tself.parent.rotationX = self.point.y - (pl102.global.y - self.point1.y) * 0.01;\r\n\t\t\tif (self.minMaxX.x > self.parent.rotationX) self.parent.rotationX = self.minMaxX.x;\r\n\t\t\tif (self.minMaxX.y < self.parent.rotationX) self.parent.rotationX = self.minMaxX.y;\r\n\t\t\tself.parent.rotationZ = self.point.x + (pl102.global.x - self.point1.x) * 0.01;\r\n\t\t}\r\n\t};\r\n\r\n\tthis.stageUpNew = function (e) {\r\n\r\n\t\tif (pl102.isMouseEvents) {\r\n\t\t\tself.sPixi.off('mouseup', self.stageUpNew);\r\n\t\t\tself.sPixi.off('mousemove', self.stageMoveNew);\r\n\t\t}\r\n\r\n\t\tif (pl102.isTouchEvents) {\r\n\t\t\tself.sPixi.off('touchend', self.stageUpNew);\r\n\t\t\tself.sPixi.off('touchmove', self.stageMoveNew);\r\n\t\t}\r\n\t};\r\n\r\n\tthis.mouseUpp = function (e) {\r\n\t\tself.parent.intRend = 1;\r\n\t};\r\n\r\n\r\n\t// if (pl102.isMouseEvents) {\r\n\t// \tself.sPixi.on('mouseup', self.mouseUpp);\r\n\t// }\r\n\r\n\t// if (pl102.isTouchEvents) {\r\n\t// \tself.sPixi.on('touchend', self.mouseUpp);\r\n\t// }\r\n\r\n\tvar isMovePan = false;\r\n\r\n\tthis.mouseDown = function (e) {\r\n\r\n\t\tif (self.pause == true) return;\r\n\t\tif (self.drag == false) return;\r\n\r\n\t\tisMovePan = false;\r\n\t\tif (self.isDragPan && e && e.data.originalEvent.button === 1) {\r\n\t\t\tisMovePan = true;\r\n\t\t\thandleMouseDownPan(e.data.originalEvent);\r\n\t\t}\r\n\r\n\t\tself.point.y = self.parent.rotationX;\r\n\t\tself.point.x = self.parent.rotationZ;\r\n\t\tif (self.isRotateScene) {\r\n\t\t\tsceneRotationY = self.parent.scene.rotation.y;\r\n\t\t}\r\n\r\n\r\n\t\tself.point1.x = pl102.global.x;\r\n\t\tself.point1.y = pl102.global.y;\r\n\r\n\t\t// self.parent.tween.stop();\r\n\r\n\t\t// stage.addEventListener(\"stagemousemove\", self.stageMoveNew);\r\n\t\t// stage.addEventListener(\"stagemouseup\", self.stageUpNew);\r\n\t\t// window.document.addEventListener('mousemove',    self.stageMoveNew, true);\r\n\t\t// window.document.addEventListener('mouseup',    self.stageUpNew, true);\r\n\t\tif (pl102.isMouseEvents) {\r\n\t\t\tself.sPixi.off('mouseup', self.stageUpNew);\r\n\t\t\tself.sPixi.off('mousemove', self.stageMoveNew);\r\n\t\t\tself.sPixi.on('mouseup', self.stageUpNew);\r\n\t\t\tself.sPixi.on('mousemove', self.stageMoveNew);\r\n\t\t}\r\n\r\n\t\tif (pl102.isTouchEvents) {\r\n\t\t\tself.sPixi.off('touchend', self.stageUpNew);\r\n\t\t\tself.sPixi.off('touchmove', self.stageMoveNew);\r\n\t\t\tself.sPixi.on('touchend', self.stageUpNew);\r\n\t\t\tself.sPixi.on('touchmove', self.stageMoveNew);\r\n\t\t}\r\n\t};\r\n\r\n\t// self.sPixi.on('mousedown', self.mouseDown);\r\n\t// main.contentCurs.addEventListener( 'mousedown', this.mouseDown); /// TODO убрал это\r\n\t// contentHTML.addEventListener('mousedown',    this.mouseDown, true);\r\n\r\n\t// self.parent.parent.parent.stage.addEventListener( 'mousedown', this.mouseDown);\r\n\tvar www;\r\n\tthis.mousewheel = function (e) {\r\n\r\n\t\tif (self.pause == true) return;\r\n\t\tif (self.drag == false) return;\r\n\r\n\r\n\t\twww = self.parent._zume + (-e.delta) * self.powerZum;\r\n\t\tif (www < self.minZum) www = self.minZum;\r\n\t\tif (www > self.maxZum) www = self.maxZum;\r\n\t\tself.parent.zume = www;\r\n\t\tself.parent.intRend = 1;\r\n\t};\r\n\r\n\tif (this.content2d != undefined) {\r\n\t\tthis.sPixi = this.getStage(this.content2d);\r\n\t\tthis.sPixi.interactive = true;\r\n\r\n\t\tif (pl102.devas == false) {\r\n\t\t\t_content2d.on('mousedown', this.mouseDown);\r\n\t\t\tpl102Wheel.on(_content2d, 'mousewheel', this.mousewheel);\r\n\t\t} else {\r\n\t\t\t_content2d.on('touchstart', this.mouseDown);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tvar panOffset = new THREE.Vector3();\r\n\tvar panStart = new THREE.Vector2();\r\n\tvar panEnd = new THREE.Vector2();\r\n\tvar panDelta = new THREE.Vector2();\r\n\r\n\tfunction handleMouseDownPan (event) {\r\n\t\tpanStart.set(event.clientX, event.clientY);\r\n\t}\r\n\r\n\tfunction handleMouseMovePan (event) {\r\n\t\tpanEnd.set(event.clientX, event.clientY);\r\n\t\tpanDelta.subVectors(panEnd, panStart);\r\n\t\tself.moveCamXY(panDelta);\r\n\t\tpanStart.copy(panEnd);\r\n\t}\r\n\tvar panLeft = (function () {\r\n\t\tvar v = new THREE.Vector3();\r\n\t\treturn function panLeft (distance, objectMatrix) {\r\n\t\t\tv.setFromMatrixColumn(objectMatrix, 0); // get X column of objectMatrix\r\n\t\t\tv.multiplyScalar(-distance);\r\n\t\t\tpanOffset.add(v);\r\n\t\t};\r\n\t}());\r\n\r\n\tvar panUp = (function () {\r\n\t\tvar v = new THREE.Vector3();\r\n\t\treturn function panUp (distance, objectMatrix) {\r\n\t\t\tv.setFromMatrixColumn(objectMatrix, 1); // get Y column of objectMatrix\r\n\t\t\tv.multiplyScalar(distance);\r\n\t\t\tpanOffset.add(v);\r\n\t\t};\r\n\t}());\r\n\tvar pan = (function () {\r\n\t\treturn function pan (deltaX, deltaY) {\r\n\t\t\tvar element = self.parent.renderer.domElement;\r\n\t\t\tif (self.parent.camera.isPerspectiveCamera) {\r\n\t\t\t\tvar targetDistance = Math.max(self.parent.zume, 10);\r\n\t\t\t\ttargetDistance *= Math.tan((self.parent.camera.fov / 2) * Math.PI / 180.0);\r\n\t\t\t\t// we actually don't use screenWidth, since perspective camera is fixed to screen height\r\n\t\t\t\tpanLeft(2 * deltaX * targetDistance / element.clientHeight, self.parent.camera.matrixWorld);\r\n\t\t\t\tpanUp(2 * deltaY * targetDistance / element.clientHeight, self.parent.camera.matrixWorld);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn('WARNING: camera neither perspective.');\r\n\t\t\t}\r\n\t\t};\r\n\t}());\r\n\r\n\tthis.moveCamXY = function (v) {\r\n\t\tpanOffset.set(0, 0, 0);\r\n\t\tself.parent.camera.updateMatrixWorld();\r\n\t\tself.parent.scene.updateMatrixWorld();\r\n\t\tif (arguments.length > 1) {\r\n\t\t\tv = {\r\n\t\t\t\tx: arguments[0],\r\n\t\t\t\ty: arguments[1]\r\n\t\t\t};\r\n\t\t}\r\n\t\tpan((v.x || 0), (v.y || 0));\r\n\t\tself.parent.xVerh += panOffset.x;\r\n\t\tself.parent.yVerh += -panOffset.y;\r\n\t\tself.parent.zVerh += panOffset.z;\r\n\r\n\t\tself.parent.xVerh = Math.max(Math.min(self.parent.xVerh, self.distMinMaxBox), -self.distMinMaxBox);\r\n\t\tself.parent.zVerh = Math.max(Math.min(self.parent.zVerh, self.distMinMaxBox), -self.distMinMaxBox);\r\n\t\tself.parent.yVerh = Math.max(Math.min(self.parent.yVerh, self.distMinMaxBox), -self.distMinMaxBox);\r\n\t\tpanOffset.set(0, 0, 0);\r\n\t};\r\n\r\n}\r\n","/*\r\n        var s = 300;\r\n        smc = new MShadowMeshContainer();\r\n        smc.fotoPosition.set(0, 0);// def 0,0\r\n        smc.fotoWH = s;// def 150\r\n\r\n        var geo = new THREE.PlaneBufferGeometry();\r\n        geo.translate(0.5, -0.5, 0);\r\n        geo.rotateX(-Math.PI / 2);\r\n\r\n        // для тени\r\n        var m = new THREE.Mesh(geo, new THREE.MeshBasicMaterial({\r\n            transparent: true,\r\n            map: smc.texturePlan\r\n        }));\r\n        m.scale.set(s, 1, s);\r\n        m.position.set(smc.fotoPosition.x, 0, smc.fotoPosition.y);\r\n        scene.add(m);\r\n\r\n        smc.upDate();// animate\r\n */\r\n\r\nimport MFoto3D from './MFoto3D.js';\r\n\r\nexport default function MShadowMeshContainer(_foto3D) {\r\n    var self = this;\r\n\r\n    var uuid = THREE.Math.generateUUID();\r\n\r\n    var normalVector = new THREE.Vector3(0, 1, 0);\r\n    var planeConstant = 0.01; // this value must be slightly higher than the groundMesh's y position of 0.0\r\n    var groundPlane = new THREE.Plane(normalVector, planeConstant);\r\n    var lightPosition4D = new THREE.Vector4(0, 999, 0, 0.001);\r\n\r\n    var box = new THREE.Box3();\r\n    var foto3D = _foto3D || new MFoto3D();\r\n    this.foto3D = foto3D;\r\n\r\n    var tp = new THREE.Vector2(0, 0);\r\n    var twh = 100;\r\n\r\n    var imageBlur = new ImageBlur(); // \r\n    this.canvas = imageBlur.canvas;\r\n\r\n    this.isTime = false;\r\n\r\n    var texturePlan = new THREE.Texture(imageBlur.canvas); // текстура плана тени !!!!\r\n    this.texturePlan = texturePlan;\r\n\r\n    this.matPlan = new THREE.MeshPhongMaterial({\r\n        transparent: true,\r\n        side: THREE.DoubleSide,\r\n        // opacity: 0.7,\r\n        map: texturePlan\r\n    });\r\n\r\n    var canvasGG = new CanvasGG();\r\n    this.canvasGG = canvasGG;\r\n    // для текстуры тени\r\n\r\n    // \"arrColorStopTranspanent\": [0.15, 1],\r\n    // \"arrProcent\": [0.82, 1]\r\n    canvasGG.arrColorStopTranspanent[0] = 0.15;\r\n    canvasGG.arrProcent[0] = 0.82;\r\n    canvasGG.arrColorStopTranspanent[1] = 1;\r\n    canvasGG.arrProcent[1] = 1;\r\n    canvasGG.update();\r\n\r\n    var textureShadow = new THREE.Texture(canvasGG.canvas); // текстура обектов тени\r\n    textureShadow.needsUpdate = true; // important!\r\n    this.textureShadow = textureShadow;\r\n\r\n    this.content3d = new THREE.Object3D(); // в нем план тени\r\n    this.shadowContent3d = new THREE.Object3D(); // контейнер для теней ()\r\n    // this.content3d.add(this.shadowContent3d);\r\n\r\n    // foto3D.addObjFoto(self.shadowContent3d);\r\n\r\n    this.meshPlan = new THREE.Mesh(new THREE.PlaneBufferGeometry(1, 1), this.matPlan); // сам пла масштабируется по scale\r\n    this.meshPlan.rotation.x = -Math.PI / 2;\r\n    this.content3d.add(this.meshPlan);\r\n\r\n    // дебагер точки света\r\n    var meshLight = new THREE.Mesh(new THREE.SphereBufferGeometry(10, 16, 16));\r\n    meshLight.position.set(lightPosition4D.x, lightPosition4D.y, lightPosition4D.z);\r\n\r\n    // if (window.visi3D && window.visi3D.objects && window.visi3D.sceneHelpers) {\r\n    //     visi3D.sceneHelpers.add(meshLight);\r\n    //     visi3D.objects.push(meshLight);\r\n    // }\r\n\r\n    // meshLight.addEventListener('objectChange', function(e) {\r\n    //     lightPosition4D.x = meshLight.position.x;\r\n    //     lightPosition4D.y = meshLight.position.y;\r\n    //     lightPosition4D.z = meshLight.position.z;\r\n    //     self.upDate();\r\n    // });\r\n\r\n    this.arrShadowMesh = []; // обекты тени\r\n    this.arrObj = []; // 3д обекты по которым делаем тени\r\n\r\n    this._dunamic = true;\r\n    this.dirty = true; // если нужно полюбому сделать рендер\r\n\r\n    this._lightPosition4D = lightPosition4D; // позиция освещения\r\n\r\n    this._fotoPosition = new THREE.Vector2(0, 0); // позиция где делать фото тени\r\n    this._fotoWH = 150; // размер что фотать\r\n\r\n    this._imgWH = 512; // размер картинки\r\n    this._imgBlur = 1; // not used\r\n    this._imgAlpha = 1; // not used\r\n\r\n    this._offsetY = 0; // смещение 0 расчетов теней\r\n    this._scaleShadow = 1; // масштаб теней\r\n\r\n    this._isDinamFotoRect = false; // true - берет размер всех обектов, false - берет размеры \r\n\r\n    this._opacityMat = 1; // прозрачность материала тени\r\n\r\n\r\n    var clipPlanes = [\r\n        new THREE.Plane(new THREE.Vector3(0, -1, 0), 100),\r\n        new THREE.Plane(new THREE.Vector3(0, 1, 0), 0),\r\n    ];\r\n\r\n    this._shadowMaterial = new THREE.MeshBasicMaterial({ // материал тени\r\n        // color: 0x000000,\r\n        side: THREE.DoubleSide,\r\n        transparent: true,\r\n        opacity: this._opacityMat,\r\n        depthWrite: false,\r\n        map: textureShadow,\r\n\r\n        clippingPlanes: clipPlanes,\r\n        clipIntersection: false\r\n\r\n    });\r\n\r\n    this.arrDataSempl = []; // данные для шагов блюра\r\n    this.arrDataSempl.push(new DataSempl(0, 200, 3, 1));\r\n\r\n\r\n    // helpers\r\n    var helpers = new THREE.Group();\r\n    this.content3d.add(helpers);\r\n\r\n    var meshShad = new THREE.Mesh(new THREE.PlaneBufferGeometry(1, 1), new THREE.MeshBasicMaterial({\r\n        side: THREE.DoubleSide,\r\n        map: textureShadow,\r\n        transparent: true,\r\n    }));\r\n    meshShad.scale.set(1, 30, 1);\r\n    meshShad.rotation.z = -Math.PI / 2;\r\n    helpers.add(meshShad);\r\n    helpers.visible = false;\r\n    this.helpers = helpers;\r\n\r\n    this.setConstMax = function(c) {\r\n        clipPlanes[0].constant = c;\r\n    };\r\n    this.setConstMin = function(c) {\r\n        clipPlanes[1].constant = -c;\r\n    };\r\n\r\n    this.addObj = function(object) {\r\n       \r\n        var index = self.arrObj.indexOf(object);\r\n        if (index != -1) return; // обект уже есть\r\n        object.updateMatrixWorld();\r\n\r\n        var sc = object.clone();\r\n        bridge(sc, object);\r\n        replaceMaterialMesh(sc);\r\n\r\n        self.arrShadowMesh.push(sc);\r\n        self.arrObj.push(object);\r\n        self.shadowContent3d.add(sc);\r\n        this.dirty = true;\r\n    };\r\n\r\n    this.removeObj = function(object) {\r\n        var index = self.arrObj.indexOf(object);\r\n        if (index == -1) return;\r\n        self.arrObj.splice(index, 1);\r\n        self.shadowContent3d.remove(self.arrShadowMesh[index]);\r\n        self.arrShadowMesh.splice(index, 1);\r\n        this.dirty = true;\r\n    };\r\n\r\n    this.clear = function() {\r\n        var len = 0;\r\n        while ((len = self.arrObj.length) > 0) {\r\n            self.removeObj(self.arrObj[len - 1]);\r\n            if (len === self.arrObj.length) {\r\n                throw new Error('object not remove');\r\n            }\r\n        }\r\n    };\r\n\r\n    this.intRend = 1;\r\n    this.intRendOk = 1;\r\n\r\n    // var tim = null;\r\n    this.upDate = function() {\r\n        if (!self.opacityMat) return;\r\n        if (self.dunamic) {\r\n            self.intRend = self.intRendOk;\r\n        }\r\n\r\n        if (self.intRend == self.intRendOk) {\r\n            // clearTimeout(tim);\r\n            // tim = setTimeout(self.render, 10);\r\n            if (self.dirty || isChangeObj()) {\r\n\r\n                self.render();\r\n            }\r\n        }\r\n        self.intRend++;\r\n    };\r\n\r\n    var offsetFotoDinamRect = 100;\r\n\r\n    this.render = function() {\r\n        if (self.isTime) console.time('render ' + uuid);\r\n\r\n        self.dirty = false;\r\n\r\n        updateShadowMatrixMesh();\r\n\r\n        // var par = self.shadowContent3d.parent;\r\n\r\n        foto3D.addObjFoto(self.shadowContent3d);\r\n\r\n        twh = self.fotoWH;\r\n        tp.x = self.fotoPosition.x;\r\n        tp.y = self.fotoPosition.y;\r\n\r\n        if (self.isDinamFotoRect) {\r\n            box.setFromObject(self.shadowContent3d);\r\n            tp.x = box.min.x;\r\n            tp.y = box.min.z;\r\n            twh = Math.max((box.max.x - box.min.x), (box.max.z - box.min.z));\r\n\r\n            tp.x -= offsetFotoDinamRect;\r\n            tp.y -= offsetFotoDinamRect;\r\n            twh += offsetFotoDinamRect * 2;\r\n        }\r\n\r\n        foto3D.moveToRect(tp.x, tp.y, twh, twh); // здвигаем \r\n\r\n        updateTexturePlan();\r\n\r\n        // foto3D.removeObjFoto(self.shadowContent3d);\r\n\r\n        self.meshPlan.scale.set(twh, twh, 1);\r\n        self.meshPlan.position.set(tp.x + twh / 2, 0, tp.y + twh / 2);\r\n\r\n        // if (par) par.add(self.shadowContent3d);\r\n\r\n        if (self.isTime) console.timeEnd('render ' + uuid);\r\n\r\n        if (self.onUpdate) self.onUpdate();\r\n    };\r\n\r\n    function isChangeObj() { // проверка изменился ли обекты\r\n        for (var i = 0; i < self.arrShadowMesh.length; i++) {\r\n\r\n            if (!self._isDinamFotoRect) {\r\n                if (!isInFotoRectMesh(self.arrShadowMesh[i])) {\r\n                    continue;\r\n                }\r\n            }\r\n            if (isChangeMesh(self.arrShadowMesh[i])) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function isInFotoRectMesh(shadowMesh) { // попадает ли обект в рект фото\r\n        var colisTarget = false;\r\n        var colisShadow = false;\r\n        var x = box.min.x;\r\n        var y = box.min.z;\r\n        var w = box.max.x - box.min.x;\r\n        var h = box.max.z - box.min.z;\r\n\r\n        box.setFromObject(shadowMesh.userData.targetObject);\r\n        x = box.min.x;\r\n        y = box.min.z;\r\n        w = box.max.x - box.min.x;\r\n        h = box.max.z - box.min.z;\r\n        colisTarget = isColRect(x, y, w, h, self.fotoPosition.x, self.fotoPosition.y, self.fotoWH, self.fotoWH);\r\n        box.setFromObject(shadowMesh);\r\n        x = box.min.x;\r\n        y = box.min.z;\r\n        w = box.max.x - box.min.x;\r\n        h = box.max.z - box.min.z;\r\n        colisShadow = isColRect(x, y, w, h, self.fotoPosition.x, self.fotoPosition.y, self.fotoWH, self.fotoWH);\r\n\r\n        if (!colisTarget && !colisShadow) { // оба обекта верхнего уровня за границой\r\n            return false;\r\n        }\r\n        //---\r\n        colisTarget = false;\r\n        colisShadow = false;\r\n        for (var i = 0; i < shadowMesh.children.length; i++) {\r\n            box.setFromObject(shadowMesh.children[i].userData.targetObject);\r\n            x = box.min.x;\r\n            y = box.min.z;\r\n            w = box.max.x - box.min.x;\r\n            h = box.max.z - box.min.z;\r\n            colisTarget = colisTarget || isColRect(x, y, w, h, self.fotoPosition.x, self.fotoPosition.y, self.fotoWH, self.fotoWH);\r\n            box.setFromObject(shadowMesh.children[i]);\r\n            x = box.min.x;\r\n            y = box.min.z;\r\n            w = box.max.x - box.min.x;\r\n            h = box.max.z - box.min.z;\r\n            colisShadow = colisShadow || isColRect(x, y, w, h, self.fotoPosition.x, self.fotoPosition.y, self.fotoWH, self.fotoWH);\r\n\r\n            if (colisTarget || colisShadow) { // какойто внутрений обект не за границой\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    function isChangeMesh(shadowMesh) { // проверка изменился ли обект\r\n        if (!isEqualsTransform(shadowMesh, shadowMesh.userData.targetObject)) {\r\n            return true;\r\n        }\r\n        for (var i = 0; i < shadowMesh.children.length; i++) {\r\n            if (isChangeMesh(shadowMesh.children[i])) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function updateTexturePlan() { // обновить текстуру плана\r\n        var c = foto3D.getCanvas(self.imgWH);\r\n        imageBlur.setCanvas(c);\r\n        // foto3D.render();\r\n        if (self.arrDataSempl.length == 0) imageBlur.update();\r\n\r\n        for (var i = 0; i < self.arrDataSempl.length; i++) {\r\n            self.setConstMin(self.arrDataSempl[i].min * self._scaleShadow + (self._offsetY));\r\n            self.setConstMax(self.arrDataSempl[i].max * self._scaleShadow + (self._offsetY));\r\n\r\n            foto3D.render();\r\n\r\n            imageBlur._blur = self.arrDataSempl[i].blur + (self._scaleShadow > 1 ? self._scaleShadow : 0);\r\n            imageBlur._alpha = self.arrDataSempl[i].alpha;\r\n            imageBlur.update();\r\n        }\r\n\r\n        self.setConstMin(-999999);\r\n        self.setConstMax(999999);\r\n        texturePlan.needsUpdate = true;\r\n    }\r\n\r\n    function applyTransfornRec(obj) { // применить трансформацию обекта рекусивно\r\n        applyTransforn(obj, obj.userData.targetObject);\r\n        for (var i = 0; i < obj.children.length; i++) {\r\n            applyTransfornRec(obj.children[i]);\r\n        }\r\n    }\r\n\r\n    function updateShadowMatrixMesh() { // пересчитать тени обектов\r\n        // return\r\n        lightPosition4D.w = 0.001; // more of a directional Light value\r\n        meshLight.position.set(lightPosition4D.x, lightPosition4D.y, lightPosition4D.z);\r\n\r\n        for (var i = 0; i < self.arrShadowMesh.length; i++) {\r\n            applyTransfornRec(self.arrShadowMesh[i]);\r\n        }\r\n\r\n        updateShadowUv();\r\n    }\r\n\r\n    var boundingBoxUv = new THREE.Box3(new THREE.Vector3(), new THREE.Vector3(300, 300, 300));\r\n    this.boundingBoxUv = boundingBoxUv;\r\n    var position = new THREE.Vector3();\r\n\r\n    function corectUVShadow(shadowMesh) { // пересчет ув по высоте\r\n        if (shadowMesh.geometry.uuid === shadowMesh.userData.targetObject.geometry.uuid) {\r\n            shadowMesh.geometry = shadowMesh.userData.targetObject.geometry.clone();\r\n        }\r\n        // shadowMesh.geometry.computeBoundingBox();\r\n        var boundingBox = boundingBoxUv; // shadowMesh.geometry.boundingBox; //boundingBoxUv; // \r\n        var py = 0;\r\n\r\n        if (shadowMesh.geometry instanceof THREE.Geometry) {\r\n\r\n            var faces = shadowMesh.geometry.faces;\r\n            var vertices = shadowMesh.geometry.vertices;\r\n            var faceVertexUvs = shadowMesh.geometry.faceVertexUvs[0];\r\n            for (var i = 0; i < faces.length; i++) {\r\n\r\n                position.set(vertices[faces[i].a].x, vertices[faces[i].a].y, vertices[faces[i].a].z);\r\n                shadowMesh.localToWorld(position);\r\n                py = 1 - getProcent(position.y - (self._offsetY /*/ self._scaleShadow*/ ), boundingBox.min.y, boundingBox.min.y + boundingBox.max.y) / 100;\r\n                faceVertexUvs[i][0].set(py, py);\r\n\r\n                position.set(vertices[faces[i].b].x, vertices[faces[i].b].y, vertices[faces[i].b].z);\r\n                shadowMesh.localToWorld(position);\r\n                py = 1 - getProcent(position.y - (self._offsetY /*/ self._scaleShadow*/ ), boundingBox.min.y, boundingBox.min.y + boundingBox.max.y) / 100;\r\n                faceVertexUvs[i][1].set(py, py);\r\n\r\n                position.set(vertices[faces[i].c].x, vertices[faces[i].c].y, vertices[faces[i].c].z);\r\n                shadowMesh.localToWorld(position);\r\n                py = 1 - getProcent(position.y - (self._offsetY /*/ self._scaleShadow*/ ), boundingBox.min.y, boundingBox.min.y + boundingBox.max.y) / 100;\r\n                faceVertexUvs[i][2].set(py, py);\r\n            }\r\n\r\n            shadowMesh.geometry.uvsNeedUpdate = true;\r\n\r\n        } else {\r\n\r\n\r\n            var arrPosition = shadowMesh.geometry.attributes.position.array;\r\n\r\n\r\n            if (!shadowMesh.geometry.attributes.uv) { // если нет атрибута создаем новый\r\n                arrUvAttribut = new Float32Array((arrPosition.length / 3) * 2);\r\n                shadowMesh.geometry.addAttribute('uv', new THREE.BufferAttribute(arrUvAttribut, 2));\r\n            }\r\n\r\n            var arrUv = shadowMesh.geometry.attributes.uv.array;\r\n            var itemSize = shadowMesh.geometry.attributes.uv.itemSize;\r\n\r\n            var arrIndex = shadowMesh.geometry.index.array;\r\n            var count = shadowMesh.geometry.index.count;\r\n\r\n            var indexUv = 0;\r\n            var indexInd = 0;\r\n\r\n            //----\r\n            for (var i = 0; i < count; i++) {\r\n                var ind = arrIndex[i];\r\n                var indP = (ind * 3);\r\n                var indUv = (ind * 2);\r\n\r\n                position.set(arrPosition[(indP)], arrPosition[(indP + 1)], arrPosition[(indP + 2)]);\r\n\r\n                shadowMesh.localToWorld(position);\r\n                // if(i%500==0)trace('--=', 'position.y', position.y);\r\n                // var px = 1 - getProcent(position.x, boundingBox.min.x, boundingBox.max.x) / 100;\r\n                py = 1 - getProcent(position.y - (self._offsetY /*/ self._scaleShadow*/ ), boundingBox.min.y, boundingBox.min.y + boundingBox.max.y * self._scaleShadow) / 100;\r\n                // var pz = 1 - getProcent(position.z, boundingBox.min.z, boundingBox.max.z) / 100;\r\n                // var ppx = 1 - calc.diffNum(0.5, px) / 0.5;\r\n                // var ppz = 1 - calc.diffNum(0.5, pz) / 0.5;\r\n                // var py = 1 - getProcent(arrPosition[(indP + 1)], boundingBox.min.y, boundingBox.max.y) / 100;\r\n                arrUv[indUv] = py; // * ppz * ppx; //(py*ppx *ppz/*+ (ppx + ppz)*0.1*/) // 3;\r\n                arrUv[indUv + 1] = py; // * ppz * ppx; //(py*ppx *ppz/*+ (ppx + ppz)*0.1*/) // 3;\r\n            }\r\n            shadowMesh.geometry.attributes.uv.needsUpdate = true;\r\n        }\r\n\r\n    }\r\n\r\n    function findRecMesh(obj, arr) { //найти все мешы в обекте\r\n        if (obj.type == 'Mesh') {\r\n            arr.push(obj);\r\n        }\r\n        for (var i = 0; i < obj.children.length; i++) {\r\n            if (obj.type == 'Mesh') {\r\n                arr.push(obj.children[i]);\r\n            } else {\r\n                findRecMesh(obj.children[i], arr);\r\n            }\r\n        }\r\n    }\r\n\r\n    function updateUvMesh(obj) {\r\n        if (obj.type === 'Mesh') {\r\n            var isUpdateUvMesh = false; // нужно ли пересчитывать ув меша \r\n            var wpos = obj.getWorldPosition(obj.position);\r\n            var wrot = obj.getWorldQuaternion(obj.quaternion);\r\n            var maxHeight = self.maxHeight;\r\n            wpos.y -= (self._offsetY /* / self._scaleShadow*/ );\r\n\r\n            if (!obj.userData.pos) { // когда первый раз зашли\r\n                isUpdateUvMesh = true;\r\n            } else if (obj.userData.pos.y != wpos.y) { // когда позиция по высоте поменылась\r\n                isUpdateUvMesh = true;\r\n            } else if (!obj.userData.rot.equals(wrot)) { // когда повернули \r\n                isUpdateUvMesh = true;\r\n            } else if (obj.userData.maxHeight !== maxHeight) { // когда поменялся конф высота\r\n                isUpdateUvMesh = true;\r\n            } else if (obj.userData.scaleShadow !== self._scaleShadow) { // когда поменялся конф высота\r\n                isUpdateUvMesh = true;\r\n            }\r\n\r\n            if (!self._isDinamFotoRect) { // оптимизация если обект за ректом его пересчитывать не нужно \r\n                box.setFromObject(obj);\r\n                if (!isColRect(box.min.x, box.min.z, box.max.x - box.min.x, box.max.z - box.min.z, self.fotoPosition.x, self.fotoPosition.y, self.fotoWH, self.fotoWH)) {\r\n                    isUpdateUvMesh = false;\r\n                }\r\n            }\r\n\r\n            if (isUpdateUvMesh) {\r\n                corectUVShadow(obj);\r\n                obj.userData.pos = wpos;\r\n                obj.userData.rot = wrot;\r\n                obj.userData.maxHeight = maxHeight;\r\n                obj.userData.scaleShadow = self._scaleShadow;\r\n            }\r\n        }\r\n        for (var i = 0; i < obj.children.length; i++) {\r\n            updateUvMesh(obj.children[i]);\r\n        }\r\n    }\r\n\r\n    function updateShadowUv() {\r\n\r\n        meshShad.scale.x = (self.boundingBoxUv.max.y || 1) * self._scaleShadow;\r\n        meshShad.position.y = (meshShad.scale.x / 2) + self.boundingBoxUv.min.y;\r\n\r\n        for (var i = 0; i < self.arrShadowMesh.length; i++) {\r\n\r\n            if (!self._isDinamFotoRect) {\r\n                box.setFromObject(self.arrShadowMesh[i]);\r\n                if (!isColRect(box.min.x, box.min.z, box.max.x - box.min.x, box.max.z - box.min.z, self.fotoPosition.x, self.fotoPosition.y, self.fotoWH, self.fotoWH)) {\r\n                    continue;\r\n                }\r\n            }\r\n\r\n            updateUvMesh(self.arrShadowMesh[i]);\r\n\r\n        }\r\n    }\r\n    this.updateShadowUv = updateShadowUv;\r\n\r\n    this.updateShadowTexture = function() {\r\n        this.canvasGG.update();\r\n        this.textureShadow.needsUpdate = true;\r\n    };\r\n\r\n    this.setShadowColor = function(r, g, b) {\r\n        canvasGG.r = r;\r\n        canvasGG.g = g;\r\n        canvasGG.b = b;\r\n        self.updateShadowTexture();\r\n    };\r\n\r\n    this.getConfig = function() {\r\n        var o = {};\r\n        o.imgWH = self.imgWH;\r\n        o.fotoPosition = {\r\n            x: self._fotoPosition.x,\r\n            y: self._fotoPosition.y\r\n        };\r\n        o.fotoWH = self.fotoWH;\r\n        o.maxHeight = self.maxHeight;\r\n        o.isDinamFotoRect = self.isDinamFotoRect;\r\n        o.arrDataSempl = self.arrDataSempl;\r\n        o.opacityMat = self.opacityMat;\r\n        o.dunamic = self.dunamic;\r\n        o.canvasGG = {\r\n            arrColorStopTranspanent: self.canvasGG.arrColorStopTranspanent,\r\n            arrProcent: self.canvasGG.arrProcent,\r\n        };\r\n        return o;\r\n    };\r\n\r\n    this.setConfig = function(o) {\r\n        self.canvasGG.arrColorStopTranspanent = o.canvasGG.arrColorStopTranspanent;\r\n        self.canvasGG.arrProcent = o.canvasGG.arrProcent;\r\n        self.fotoPosition.x = o.fotoPosition.x;\r\n        self.fotoPosition.y = o.fotoPosition.y;\r\n        self.fotoWH = o.fotoWH;\r\n        self.isDinamFotoRect = o.isDinamFotoRect;\r\n        self.arrDataSempl = o.arrDataSempl;\r\n        self.opacityMat = o.opacityMat;\r\n        self.imgWH = o.imgWH;\r\n        self.dunamic = o.dunamic;\r\n        self.updateShadowTexture();\r\n        self.maxHeight = o.maxHeight;\r\n\r\n    };\r\n\r\n    var sss = {\r\n        \"imgWH\": 1024,\r\n        \"fotoPosition\": {\r\n            \"x\": 0,\r\n            \"y\": 0\r\n        },\r\n        \"fotoWH\": 150,\r\n        \"maxHeight\": 300,\r\n        \"isDinamFotoRect\": false,\r\n        \"arrDataSempl\": [{\r\n            \"min\": 0,\r\n            \"max\": 6,\r\n            \"blur\": 0.8,\r\n            \"alpha\": 0.25\r\n        }, {\r\n            \"min\": 4,\r\n            \"max\": 15,\r\n            \"blur\": 3,\r\n            \"alpha\": 0.64\r\n        }, {\r\n            \"min\": 10,\r\n            \"max\": 23,\r\n            \"blur\": 4,\r\n            \"alpha\": 0.5\r\n        }, {\r\n            \"min\": 15,\r\n            \"max\": 50,\r\n            \"blur\": 15,\r\n            \"alpha\": 1\r\n        }, {\r\n            \"min\": 20,\r\n            \"max\": 198.09,\r\n            \"blur\": 15,\r\n            \"alpha\": 0.7\r\n        }, {\r\n            \"min\": 0,\r\n            \"max\": 2,\r\n            \"blur\": 1.02,\r\n            \"alpha\": 1\r\n        }],\r\n        \"opacityMat\": 1,\r\n        \"dunamic\": true,\r\n        \"canvasGG\": {\r\n            \"arrColorStopTranspanent\": [0, 1, 0.25],\r\n            \"arrProcent\": [0.4, 1, 0.96]\r\n        }\r\n    };\r\n    this.sss = sss;\r\n    this.setConfig(sss);\r\n\r\n    function bridge(obj, obj1) { // установка связи\r\n        obj.userData.targetObject = obj1;\r\n        for (var i = 0; i < obj.children.length; i++) {\r\n            if (!obj1.children[i]) throw new Error('обекты не одинаковы');\r\n            bridge(obj.children[i], obj1.children[i]);\r\n        }\r\n    }\r\n\r\n    function replaceMaterialMesh(obj) { // замена материалов \r\n        var arr = [];\r\n        findRecMesh(obj, arr);\r\n        for (var i = 0; i < arr.length; i++) {\r\n            arr[i].material = self._shadowMaterial;\r\n        }\r\n    }\r\n\r\n    function isEqualsTransform(obj, obj1) { // одинакова ли трансформация обектов\r\n        var isEqualsPos = false;\r\n        // if (self._scaleShadow !== 1) {\r\n        //     isEqualsPos = \r\n        //         (Math.abs((obj.position.x * self._scaleShadow) - obj1.position.x) < 1) &&\r\n        //         (Math.abs((obj.position.y * self._scaleShadow) - obj1.position.y) < 1) &&\r\n        //         (Math.abs((obj.position.z * self._scaleShadow) - obj1.position.z) < 1);\r\n\r\n        // } else {\r\n        isEqualsPos = obj.position.equals(obj1.position);\r\n        // }\r\n\r\n        if (isEqualsPos &&\r\n            obj.quaternion.equals(obj1.quaternion) &&\r\n            (obj.scale.equals(obj1.scale)\r\n                // obj.scale.x === obj1.scale.x &&\r\n                // obj.scale.z === obj1.scale.z\r\n            ) &&\r\n            obj.visible === obj1.visible) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function applyTransforn(obj, obj1) { // скопировать трансф обекта\r\n        obj.position.copy(obj1.position);\r\n        obj.quaternion.copy(obj1.quaternion);\r\n        obj.scale.copy(obj1.scale);\r\n        obj.visible = obj1.visible;\r\n\r\n        // if (self._scaleShadow !== 1) {\r\n        //     obj.position.x = obj1.position.x / self._scaleShadow;\r\n        //     obj.position.y = obj1.position.y / self._scaleShadow;\r\n        //     obj.position.z = obj1.position.z / self._scaleShadow;\r\n        // }\r\n\r\n        // obj.scale.set(1, 1, 1);// ignore scale object\r\n    }\r\n\r\n\r\n    // проверка на пересечение прямоугольников\r\n    function isColRect(x1, y1, w1, h1, x2, y2, w2, h2) {\r\n        return x1 < (x2 + w2) && y1 < (y2 + h2) && (x1 + w1) > x2 && (y1 + h1) > y2;\r\n    }\r\n\r\n    function getProcent(val, min, max, okrug) {\r\n        min = min != undefined ? min : 0;\r\n        max = max != undefined ? max : 100;\r\n        okrug = okrug || 100;\r\n        if (isNaN(parseFloat(val))) val = min;\r\n        if (val < min) val = min;\r\n        if (val > max) val = max;\r\n        val = Math.round(val * okrug) / okrug;\r\n        return (min < 0) ? (Math.abs(min) + val) * 100 / ((Math.abs(min) + Math.abs(max)) || 1) :\r\n            (Math.abs(min) - val) * 100 / ((Math.abs(min) - Math.abs(max)) || 1);\r\n    }\r\n\r\n    function roundNum(num, siz) {\r\n        siz = siz != undefined ? siz : 10000;\r\n        return Math.round((num * siz)) / siz;\r\n    }\r\n\r\n    this.getBase64 = function() {\r\n        self.render();\r\n        return imageBlur.canvas.toDataURL();\r\n    };\r\n\r\n    this.debug = false;\r\n}\r\n\r\nObject.defineProperties(MShadowMeshContainer.prototype, {\r\n\r\n    scaleShadow: {\r\n        set: function(value) {\r\n            this.dirty = true;\r\n            this._scaleShadow = value;\r\n            // this.content3d.scale.x = this.content3d.scale.z = value;\r\n        },\r\n        get: function() {\r\n            return this._scaleShadow;\r\n        }\r\n    },\r\n\r\n    debug: {\r\n        set: function(value) {\r\n            this.helpers.visible = value;\r\n        },\r\n        get: function() {\r\n            return this.helpers.visible;\r\n        }\r\n    },\r\n    offsetY: {\r\n        set: function(value) {\r\n            this._offsetY = value;\r\n            this.dirty = true;\r\n        },\r\n        get: function() {\r\n            return this._offsetY;\r\n        }\r\n    },\r\n\r\n    maxHeight: {\r\n        set: function(value) {\r\n            this.dirty = true;\r\n            this.boundingBoxUv.max.y = value;\r\n            this.updateShadowUv();\r\n        },\r\n        get: function() {\r\n            return this.boundingBoxUv.max.y;\r\n        }\r\n    },\r\n\r\n    dunamic: {\r\n        set: function(value) {\r\n            this.dirty = true;\r\n            this._dunamic = value;\r\n        },\r\n        get: function() {\r\n            return this._dunamic;\r\n        }\r\n    },\r\n    fotoPosition: {\r\n        set: function(value) {\r\n            this.dirty = true;\r\n            this._fotoPosition = value;\r\n        },\r\n        get: function() {\r\n            return this._fotoPosition;\r\n        }\r\n    },\r\n    fotoWH: {\r\n        set: function(value) {\r\n            this.dirty = true;\r\n            this._fotoWH = value;\r\n        },\r\n        get: function() {\r\n            return this._fotoWH;\r\n        }\r\n    },\r\n    imgWH: {\r\n        set: function(value) {\r\n            this.dirty = true;\r\n            this._imgWH = value;\r\n        },\r\n        get: function() {\r\n            return this._imgWH;\r\n        }\r\n    },\r\n    imgBlur: {\r\n        set: function(value) {\r\n            this.dirty = true;\r\n            this._imgBlur = value;\r\n        },\r\n        get: function() {\r\n            this.dirty = true;\r\n            return this._imgBlur;\r\n        }\r\n    },\r\n    imgAlpha: {\r\n        set: function(value) {\r\n            this.dirty = true;\r\n            this._imgAlpha = value;\r\n        },\r\n        get: function() {\r\n            return this._imgAlpha;\r\n        }\r\n    },\r\n\r\n    isDinamFotoRect: {\r\n        set: function(value) {\r\n            this.dirty = true;\r\n            this._isDinamFotoRect = value;\r\n        },\r\n        get: function() {\r\n            return this._isDinamFotoRect;\r\n        }\r\n    },\r\n    opacityMat: {\r\n        set: function(value) {\r\n            this.dirty = true;\r\n            this._opacityMat = value;\r\n            this.matPlan.opacity = this._opacityMat;\r\n        },\r\n        get: function() {\r\n            return this._opacityMat;\r\n        }\r\n    },\r\n\r\n    shadowMaterial: {\r\n        set: function(value) {\r\n            if (value !== this._shadowMaterial) {\r\n                this._shadowMaterial = value;\r\n                for (var i = 0; i < this.arrShadowMesh.length; i++) {\r\n                    if (this.arrShadowMesh[i] instanceof THREE.ShadowMesh) {\r\n                        this.arrShadowMesh[i].material = this._shadowMaterial;\r\n                    } else {\r\n                        for (var j = 0; j < this.arrShadowMesh[i].children.length; j++) {\r\n                            if (this.arrShadowMesh[i].children[j] instanceof THREE.ShadowMesh) {\r\n                                this.arrShadowMesh[i].children[j].material = this._shadowMaterial;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        get: function() {\r\n            return this._shadowMaterial;\r\n        }\r\n    },\r\n\r\n    lightPosition4D: {\r\n        set: function(value) {\r\n            this._lightPosition4D.set(value.x, value.y, value.z, 0.001);\r\n        },\r\n        get: function() {\r\n            return this._lightPosition4D;\r\n        }\r\n    },\r\n\r\n});\r\n\r\n\r\nfunction DataSempl(min, max, blur, alpha) {\r\n    this.min = min || 0;\r\n    this.max = max || 1;\r\n    this.blur = blur || 0;\r\n    this.alpha = alpha || 1;\r\n}\r\n\r\n\r\n\r\nfunction ImageBlur() {\r\n    var self = this;\r\n\r\n    var canvas = document.createElement('canvas');\r\n    this.canvas = canvas;\r\n    canvas.width = 256;\r\n    canvas.height = 256;\r\n    var context = canvas.getContext(\"2d\");\r\n    var img = new Image();\r\n    this.b64 = null;\r\n    this._blur = 0;\r\n    this._blur1 = 1;\r\n    this._alpha = 1;\r\n    this.image = new Image();\r\n\r\n    this.setBase64 = function(_b64, fun) {\r\n        this.b64 = _b64;\r\n        img = new Image();\r\n        img.onload = function() {\r\n            canvas.clearRect(0, 0, canvas.width, canvas.height);\r\n            canvas.width = img.width;\r\n            canvas.height = img.height;\r\n            self.update();\r\n            if (fun) fun(canvas.toDataURL());\r\n        };\r\n        img.src = _b64;\r\n    };\r\n\r\n    this.setCanvas = function(c) {\r\n        img = c;\r\n        canvas.width = c.width;\r\n        canvas.height = c.height;\r\n        // self.update();\r\n    };\r\n\r\n    this.update = function() {\r\n        // context.clearRect(0, 0, canvas.width, canvas.height);\r\n        // context.filter = 'blur(' + self._blur1 + 'px)';\r\n        // context.globalAlpha = 0.1;\r\n        // context.drawImage(img, 0, 0);\r\n        context.filter = 'blur(' + self._blur + 'px)';\r\n        context.globalAlpha = self._alpha;\r\n        context.drawImage(img, 0, 0);\r\n    };\r\n}\r\nObject.defineProperties(ImageBlur.prototype, {\r\n    blur: {\r\n        set: function(value) {\r\n            this._blur = value;\r\n            // this.update();\r\n        },\r\n        get: function() {\r\n            return this._blur;\r\n        }\r\n    },\r\n    alpha: {\r\n        set: function(value) {\r\n            this._alpha = value;\r\n            // this.update();\r\n        },\r\n        get: function() {\r\n            return this._alpha;\r\n        }\r\n    },\r\n\r\n});\r\n\r\nfunction CanvasGG() {\r\n    var self = this;\r\n\r\n    var canvas = document.createElement('canvas');\r\n    // document.body.appendChild(canvas);\r\n    // canvas.style.position = 'fixed';\r\n    canvas.width = canvas.height = 256;\r\n    this.canvas = canvas;\r\n    var context = canvas.getContext(\"2d\");\r\n    this._blur = 0;\r\n    this._alpha = 1;\r\n\r\n    this.arrColorStopTranspanent = [0, 1]; //CSS Colors transpanent\r\n    this.arrProcent = [0, 1]; //0 ... 1\r\n\r\n    this.position = new THREE.Vector2(); //0 ... 1\r\n    this.position1 = new THREE.Vector2(1, 0); //0 ... 1\r\n\r\n    this.r = 0;\r\n    this.g = 0;\r\n    this.b = 0;\r\n\r\n    this.update = function() {\r\n        var w = canvas.width;\r\n        var h = canvas.height;\r\n\r\n        context.clearRect(0, 0, w, h);\r\n\r\n        context.rect(0, 0, w, h);\r\n        context.filter = 'blur(' + self._blur + 'px)';\r\n        context.globalAlpha = self._alpha;\r\n\r\n        var px = self.position.x * w;\r\n        var py = self.position.y * h;\r\n        var px1 = self.position1.x * w;\r\n        var py1 = self.position1.y * h;\r\n\r\n        var gradient = context.createLinearGradient(px, py, px1, py1);\r\n\r\n        for (var i = 0; i < self.arrColorStopTranspanent.length; i++) {\r\n            gradient.addColorStop(self.arrProcent[i], 'rgba(' + self.r + ',' + self.g + ',' + self.b + ',' + self.arrColorStopTranspanent[i] + ')');\r\n        }\r\n\r\n        context.fillStyle = gradient;\r\n        context.fill();\r\n\r\n    };\r\n    this.update();\r\n}\r\nObject.defineProperties(CanvasGG.prototype, {\r\n    // blur: {\r\n    //     set: function(value) {\r\n    //         this._blur = value;\r\n    //         this.update();\r\n    //     },\r\n    //     get: function() {\r\n    //         return this._blur;\r\n    //     }\r\n    // },\r\n    // alpha: {\r\n    //     set: function(value) {\r\n    //         this._alpha = value;\r\n    //         this.update();\r\n    //     },\r\n    //     get: function() {\r\n    //         return this._alpha;\r\n    //     }\r\n    // },\r\n\r\n});","/*\r\n \r\n*/\r\nexport default function MFoto3D() { // для фотографирования 3д\r\n    var self = this;\r\n\r\n    var SCREEN_WIDTH = 256;\r\n    var SCREEN_HEIGHT = 256;\r\n\r\n    var scene = new THREE.Scene();\r\n    // var camera = new THREE.PerspectiveCamera(54, SCREEN_WIDTH / SCREEN_HEIGHT, 0.01, 1000000);\r\n    var camera = new THREE.OrthographicCamera(SCREEN_WIDTH / -2, SCREEN_WIDTH / 2, SCREEN_HEIGHT / 2, SCREEN_HEIGHT / -2, 0.001, 10000);\r\n    var clock = new THREE.Clock();\r\n    var renderer = new THREE.WebGLRenderer({\r\n        antialias: true,\r\n        alpha: true,\r\n        preserveDrawingBuffer: true\r\n    });\r\n    camera.position.set(200, 200, 200);\r\n    scene.add(camera);\r\n\r\n    // var ctx = renderer.context.canvas.getContext(\"webgl\");\r\n    \r\n    this.camera = camera;\r\n\r\n    this.fotoContainer = new THREE.Object3D();\r\n    scene.add(this.fotoContainer);\r\n\r\n    scene.background = new THREE.Color(0x0096ff);\r\n    renderer.setPixelRatio(window.devicePixelRatio);\r\n    renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);\r\n\r\n    renderer.localClippingEnabled = true; //\r\n\r\n    var contentHTML = document.createElement('div');\r\n    contentHTML.style.position = 'absolute';\r\n    contentHTML.style.bottom = '0px';\r\n    contentHTML.style.left = '0px';\r\n    // contentHTML.style.zIndex = '150';\r\n    contentHTML.appendChild(renderer.domElement);\r\n    this.contentHTML = contentHTML;\r\n    this.canvas = renderer.domElement;\r\n    this.contentHTML = contentHTML;\r\n    // document.body.appendChild(contentHTML);\r\n\r\n    var ambientLight = new THREE.AmbientLight(\"#ffffff\", 1);\r\n    scene.add(ambientLight);\r\n    // var sunLight = new THREE.DirectionalLight('rgb(255,255,255)', 0.9);\r\n    // scene.add(sunLight);\r\n\r\n    // helper debug\r\n    var gridHelper = new THREE.GridHelper(1000, 10);\r\n    var axesHelper = new THREE.AxesHelper(100);\r\n    var boxHelper = new THREE.BoxHelper(this.fotoContainer, 0xffff00);\r\n    scene.add(gridHelper);\r\n    scene.add(axesHelper);\r\n    scene.add(boxHelper);\r\n\r\n    var arrHelper = [axesHelper, gridHelper, boxHelper];\r\n\r\n    function animate() {\r\n        render();\r\n        boxHelper.setFromObject(self.fotoContainer);\r\n    }\r\n\r\n    function render() {\r\n        renderer.render(scene, camera);\r\n    }\r\n    this.render = render;\r\n    animate();\r\n\r\n\r\n    var box = new THREE.Box3();\r\n    var center = new THREE.Vector3();\r\n\r\n    this.box = box;\r\n    this.center = center;\r\n\r\n\r\n    this.setSize = function(width, height) { // размер рендера\r\n        SCREEN_WIDTH = width;\r\n        SCREEN_HEIGHT = height;\r\n        renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);\r\n        camera.aspect = SCREEN_WIDTH / SCREEN_HEIGHT;\r\n        camera.updateProjectionMatrix();\r\n    };\r\n\r\n    this.addObjFoto = function(obj) {\r\n        // this.fotoContainer.children.length = 0;\r\n        // obj.position.set(0, 0, 0);\r\n        // obj.visible = true;\r\n        this.fotoContainer.add(obj);\r\n        boxHelper.setFromObject(this.fotoContainer);\r\n    };\r\n    this.removeObjFoto = function(obj) {\r\n        this.fotoContainer.remove(obj);\r\n    };\r\n\r\n\r\n    this.moveToObj = function(obj) {\r\n        box.setFromObject(obj || self.fotoContainer);\r\n        var w = (box.max.x - box.min.x);\r\n        var h = (box.max.z - box.min.z);\r\n        self.moveToRect(box.min.x, box.min.z, w, h);\r\n    };\r\n\r\n    this.moveToRect = function(x, y, w, h) { // здвинуть на рект\r\n        x += w / 2;\r\n        y += h / 2;\r\n        center.set(x, 0, y);\r\n\r\n        camera.position.set(center.x, 9000, center.z);\r\n        camera.lookAt(center);\r\n\r\n        orbitControls.target.set(center.x, center.y, center.z);\r\n\r\n        if (camera.type === 'OrthographicCamera') {\r\n            var s = Math.max(h, w);\r\n            camera.zoom = 1;\r\n            camera.left = s / -2;\r\n            camera.right = s / 2;\r\n            camera.top = s / 2;\r\n            camera.bottom = s / -2;\r\n            camera.aspect = s / s;\r\n        }\r\n        camera.updateProjectionMatrix();\r\n        // render();\r\n    };\r\n\r\n    this.getFoto = function(imgWH) { /// получить b64\r\n        imgWH = imgWH || 1024;\r\n\r\n        for (var i = 0; i < arrHelper.length; i++) {\r\n            arrHelper[i].visible = false;\r\n        }\r\n        var prev = scene.background;\r\n        scene.background = null;\r\n        renderer.setSize(imgWH, imgWH);\r\n        render();\r\n        var imgData = renderer.domElement.toDataURL(\"image/png\");\r\n        renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);\r\n        scene.background = prev;\r\n\r\n        for (var j = 0; j < arrHelper.length; j++) {\r\n            arrHelper[j].visible = true;\r\n        }\r\n        render();\r\n        return imgData;\r\n    };\r\n\r\n    this.getCanvas = function(imgWH) {\r\n        imgWH = imgWH || 1024;\r\n        for (var i = 0; i < arrHelper.length; i++) {\r\n            arrHelper[i].visible = false;\r\n        }\r\n        var prev = scene.background;\r\n        scene.background = null;\r\n\r\n        var wh = renderer.getSize();\r\n        if (wh.width != imgWH || wh.height != imgWH) {\r\n            renderer.setSize(imgWH, imgWH);\r\n        }\r\n        render();\r\n\r\n        // todo delete\r\n        // setTimeout(function() {\r\n        //     renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);\r\n        //     scene.background = prev;\r\n\r\n        //     for (var j = 0; j < arrHelper.length; j++) {\r\n        //         arrHelper[j].visible = true;\r\n        //     }\r\n        //     render();\r\n\r\n        // }, 1);\r\n\r\n        return renderer.domElement;\r\n    };\r\n\r\n\r\n    // дебаг управление todo delete\r\n    var orbitControls = new THREE.OrbitControls(camera, contentHTML);\r\n    orbitControls.enableKeys = false;\r\n    orbitControls.minDistance = 1;\r\n    orbitControls.minZoom = 1;\r\n    orbitControls.maxZoom = 1;\r\n    orbitControls.addEventListener('change', function() {\r\n        animate();\r\n    });\r\n\r\n}","export default function MFocus (visi3D) {\r\n\tvar self = this;\r\n\r\n\tthis.visi3D = visi3D;\r\n\r\n\tthis.box3 = new THREE.Box3();\t// 3d bound\r\n\tthis.rectScreen = new Rectangle();\r\n\r\n\tthis.world = new Rectangle(0, 0, 100, 100); //\r\n\r\n\tthis.targetObject = null; // если нужно по обекту подстраиватся THREE.Object3D || null тогда по arrPoint\r\n\tthis.arrPoint = []; // точки 3d для расчета\r\n\r\n\tthis.isMoveCam = false;\r\n\tthis.isFromGeometry = false;// подстраивать по геометрии или по bounds\r\n\r\n\tthis._offset = 0; // отступ границ\r\n\tthis._active = true;\r\n\tthis._debug = false;\r\n\r\n\r\n\tvar offsetVector = new THREE.Vector2();\r\n\tvar vec = new THREE.Vector2();\r\n\tvar center3 = new THREE.Vector3();\r\n\r\n\tthis.upDate = function () {\r\n\t\tif (!self.active) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.updateBound3d();\r\n\t\tif (self.box3.isEmpty()) return;\r\n\t\t// console.time('zumeVisi3D');\r\n\t\tthis.visi3D.xVerh = center3.x;\r\n\t\tthis.visi3D.zVerh = center3.z;\r\n\t\tthis.visi3D.yVerh = -center3.y;\r\n\t\tself.zumeVisi3D();\r\n\r\n\t\tif (self.isMoveCam) {\r\n\t\t\tdoZoom();\r\n\t\t\tvar maxCountStep = 10;\r\n\t\t\tvar countStep = 0;\r\n\t\t\twhile ((offsetVector.length() > 2) && (++countStep < maxCountStep)) {\r\n\t\t\t\tthis.visi3D.position3d.moveCamXY(offsetVector);\r\n\t\t\t\tdoZoom();\r\n\t\t\t}\r\n\t\t}\r\n\t\t// console.timeEnd('zumeVisi3D');\r\n\t\tif (self.debugFocus) self.debugFocus.upDate();\r\n\t};\r\n\tfunction doZoom () {\r\n\t\tself.zumeVisi3D();\r\n\t\toffsetVector.set(self.world.x + self.world.width / 2, self.world.y + self.world.height / 2);\r\n\t\tvec.set(self.rectScreen.x + self.rectScreen.width / 2, self.rectScreen.y + self.rectScreen.height / 2);\r\n\t\toffsetVector.sub(vec).divideScalar(2);\r\n\t}\r\n\r\n\tthis.zumeVisi3D = function () {\r\n\t\tvar eps = 0.01;\r\n\t\tvar low = 0;\r\n\t\tvar high = 60000;\r\n\r\n\t\tvar mid;\r\n\t\tvar val;\r\n\r\n\t\tvar maxCountStep = 20;\r\n\t\tvar countStep = 0;\r\n\r\n\t\twhile (low < high) { // ищем бинарным поиском\r\n\r\n\t\t\tif (++countStep > maxCountStep) break;\r\n\r\n\t\t\tmid = (low + high) / 2;\r\n\t\t\tval = mid;\r\n\r\n\t\t\tself.visi3D.zume = val;\r\n\r\n\t\t\tif (Math.abs(low - mid) < eps || Math.abs(high - mid) < eps || mid < eps) {\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\tself.updateRectScreen();\r\n\t\t\t\tif (self.isZoomIn()) {\r\n\t\t\t\t\thigh = mid;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlow = mid + 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// пересчет 3д бокса\r\n\tthis.updateBound3d = function () {\r\n\t\tself.box3.makeEmpty();\r\n\t\tif (self.targetObject) {\r\n\t\t\t// console.time('bound')\r\n\t\t\tself.box3.copy(self.getCompoundBoundingBox(self.targetObject));\r\n\t\t\t// console.timeEnd('bound')\r\n\t\t\t// console.time('from')\r\n\t\t\t// self.box3.setFromObject(self.targetObject);\r\n\t\t\t// console.timeEnd('from')\r\n\t\t} else {\r\n\t\t\tfor (var i = 0; i < self.arrPoint.length; i++) {\r\n\t\t\t\tself.box3.expandByPoint(self.arrPoint[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tself.box3.getCenter(center3);\r\n\t};\r\n\r\n\tthis.updateRectScreen = function () {\r\n\r\n\t\tthis.visi3D.camera.updateMatrixWorld();\r\n\t\tthis.visi3D.scene.updateMatrixWorld();\r\n\r\n\t\tif (self.targetObject && self.isFromGeometry) {\r\n\t\t\tvar boxs = self.getBoxObject(self.targetObject);\r\n\t\t\tself.box3.copy(boxs.box3);\r\n\t\t\tself.box3.getCenter(center3);\r\n\t\t\tself.setRectFromBox(self.rectScreen, boxs.box2);\r\n\t\t} else {\r\n\t\t\tself.setRectFromBox(self.rectScreen, self.boxToScreen(self.box3));\r\n\t\t}\r\n\t\tself.updateWorldSize();\r\n\t};\r\n\r\n\tthis.setRectFromBox = function (r, b2) {\r\n\t\tr.x = b2.min.x;\r\n\t\tr.y = b2.min.y;\r\n\t\tr.width = (b2.max.x - b2.min.x);\r\n\t\tr.height = (b2.max.y - b2.min.y);\r\n\t};\r\n\r\n\tthis.getCompoundBoundingBox = (function () {\r\n\t\tvar box3 = new THREE.Box3();\r\n\t\tvar boundingBox = new THREE.Box3();\r\n\t\tfunction traverseBound (node) {\r\n\t\t\tvar geometry = node.geometry;\r\n\t\t\tif (geometry === undefined) return;\r\n\t\t\tif (!geometry.boundingBox) geometry.computeBoundingBox();\r\n\t\t\tboundingBox.copy(geometry.boundingBox);\r\n\t\t\tboundingBox.applyMatrix4(node.matrixWorld);\r\n\t\t\tbox3.union(boundingBox);\r\n\t\t}\r\n\t\treturn function (object) {\r\n\t\t\tobject.updateMatrixWorld(true);\r\n\t\t\tbox3.makeEmpty();\r\n\t\t\tobject.traverseVisible(traverseBound);\r\n\t\t\treturn box3;\r\n\t\t};\r\n\t}());\r\n\r\n\tthis.boxToScreen = (function () {\r\n\t\tvar b2 = new THREE.Box2();\r\n\t\tvar arrP = []; // крайние точки\r\n\t\tfor (var i = 0; i < 8; i++) {\r\n\t\t\tarrP[i] = new THREE.Vector3();\r\n\t\t}\r\n\t\treturn function boxToScreen (b3) {\r\n\t\t\tb2.makeEmpty();\r\n\t\t\tarrP[0].set(b3.min.x, b3.min.y, b3.min.z);\r\n\t\t\tarrP[1].set(b3.min.x, b3.max.y, b3.min.z);\r\n\t\t\tarrP[2].set(b3.max.x, b3.min.y, b3.min.z);\r\n\t\t\tarrP[3].set(b3.max.x, b3.max.y, b3.min.z);\r\n\t\t\tarrP[4].set(b3.min.x, b3.min.y, b3.max.z);\r\n\t\t\tarrP[5].set(b3.min.x, b3.max.y, b3.max.z);\r\n\t\t\tarrP[6].set(b3.max.x, b3.min.y, b3.max.z);\r\n\t\t\tarrP[7].set(b3.max.x, b3.max.y, b3.max.z);\r\n\t\t\tfor (var i = 0; i < arrP.length; i++) {\r\n\t\t\t\tb2.expandByPoint(self.toScreenXY(arrP[i]));\r\n\t\t\t}\r\n\t\t\treturn b2;\r\n\t\t};\r\n\t}());\r\n\r\n\tthis.getBoxObject = (function () {\r\n\t\tvar box2 = new THREE.Box2();\r\n\t\tvar box3 = new THREE.Box3();\r\n\t\tvar res = {box2: box2, box3: box3};\r\n\t\tvar i, l;\r\n\t\tvar v1 = new THREE.Vector3();\r\n\t\tfunction traverseGeom (node) {\r\n\t\t\tvar geometry = node.geometry;\r\n\t\t\tif (geometry !== undefined) {\r\n\t\t\t\tif (geometry.isGeometry) {\r\n\t\t\t\t\tvar vertices = geometry.vertices;\r\n\t\t\t\t\tfor (i = 0, l = vertices.length; i < l; i++) {\r\n\t\t\t\t\t\tv1.copy(vertices[ i ]).applyMatrix4(node.matrixWorld);\r\n\t\t\t\t\t\tbox3.expandByPoint(v1);\r\n\t\t\t\t\t\tbox2.expandByPoint(self.toScreenXY(v1));\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (geometry.isBufferGeometry) {\r\n\t\t\t\t\tvar attribute = geometry.attributes.position;\r\n\t\t\t\t\tif (attribute !== undefined) {\r\n\t\t\t\t\t\tfor (i = 0, l = attribute.count; i < l; i++) {\r\n\t\t\t\t\t\t\tv1.fromBufferAttribute(attribute, i).applyMatrix4(node.matrixWorld);\r\n\t\t\t\t\t\t\tbox3.expandByPoint(v1);\r\n\t\t\t\t\t\t\tbox2.expandByPoint(self.toScreenXY(v1));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn function getBoxObject (object) {\r\n\t\t\tobject.updateMatrixWorld(true);\r\n\t\t\tbox2.makeEmpty();\r\n\t\t\tbox3.makeEmpty();\r\n\t\t\tobject.traverseVisible(traverseGeom);\r\n\t\t\treturn res;\r\n\t\t};\r\n\t}());\r\n\r\n\tvar vectorScreen = new THREE.Vector2();\r\n\tvar vector3 = new THREE.Vector3();\r\n\tthis.toScreenXY = function (v3) { // 3d world vector to screen\r\n\t\tvector3.copy(v3);\r\n\t\tvector3.project(self.visi3D.camera);\r\n\t\tvectorScreen.x = Math.round((vector3.x + 1) * self.visi3D._width / 2);\r\n\t\tvectorScreen.y = Math.round((-vector3.y + 1) * self.visi3D._height / 2);\r\n\t\treturn vectorScreen;\r\n\t};\r\n\r\n\tthis.updateWorldSize = function () {\r\n\t\tself.world.x = self.offset;\r\n\t\tself.world.y = self.offset;\r\n\t\tself.world.width = this.visi3D._width - self.offset * 2;\r\n\t\tself.world.height = this.visi3D._height - self.offset * 2;\r\n\t};\r\n\r\n\tthis.isZoomIn = function () {\r\n\t\treturn (self.rectScreen.x > self.world.x && self.rectScreen.x + self.rectScreen.width < self.world.x + self.world.width &&\r\n\t\t\tself.rectScreen.y > self.world.y && self.rectScreen.y + self.rectScreen.height < self.world.y + self.world.height);\r\n\t};\r\n\r\n}\r\n\r\nMFocus.prototype = {\r\n\tset offset (v) {\r\n\t\tthis._offset = v || 0;\r\n\t},\r\n\tget offset () {\r\n\t\treturn this._offset;\r\n\t},\r\n\r\n\tset debug (v) {\r\n\t\tthis._debug = v;\r\n\t\tif (v && !this.debugFocus) {\r\n\t\t\tthis.debugFocus = new MFocusDebug(this);\r\n\t\t}\r\n\t\tif (this.debugFocus) this.debugFocus.active = v;\r\n\t},\r\n\tget debug () {\r\n\t\treturn this._debug;\r\n\t},\r\n\r\n\tset active (v) {\r\n\t\tthis._active = v;\r\n\t\tif (!v) this.debug = false;\r\n\t},\r\n\tget active () {\r\n\t\treturn this._active;\r\n\t}\r\n};\r\n\r\nfunction MFocusDebug (mFocus) {\r\n\tvar self = this;\r\n\tthis.mFocus = mFocus;\r\n\tvar content3d = visi3D.scene;\r\n\tvar content2d = main.stage;\r\n\r\n\tvar boxHelper = new BoxHelper(1, materialAlphaRed);\r\n\tcontent3d.add(boxHelper);\r\n\r\n\tvar graphics = new PIXI.Graphics();\r\n\tgraphics.hitArea = new PIXI.Rectangle(0, 0, 0, 0);\r\n\tcontent2d.addChild(graphics);\r\n\tself.active = false;\r\n\tboxHelper.visible = graphics.visible = self.active;\r\n\tthis.upDate = function () {\r\n\t\tboxHelper.visible = graphics.visible = self.active;\r\n\t\tif (!self.active) return;\r\n\t\tgraphics.clear();\r\n\t\tgraphics.position.set(visi3D._x, visi3D._y);\r\n\t\tgraphics.lineStyle(1, 0, 1);\r\n\t\tgraphics.drawRect(mFocus.world.x, mFocus.world.y, mFocus.world.width, mFocus.world.height);\r\n\t\tgraphics.lineStyle(1, 0xff0000, 1);\r\n\t\tgraphics.drawRect(mFocus.rectScreen.x, mFocus.rectScreen.y, mFocus.rectScreen.width, mFocus.rectScreen.height);\r\n\r\n\t\tboxHelper.width = mFocus.box3.max.x - mFocus.box3.min.x;\r\n\t\tboxHelper.depth = mFocus.box3.max.y - mFocus.box3.min.y;\r\n\t\tboxHelper.height = mFocus.box3.max.z - mFocus.box3.min.z;\r\n\t\tmFocus.box3.getCenter(boxHelper.position);\r\n\t};\r\n\r\n}\r\n","\r\n// 'евент диспатча'\r\n\r\nexport default function MEventSob () {\r\n\r\n\tthis.event = undefined;\r\n\r\n\tthis.arrSobName = ['up', 'down', \t'move',\t'out', \t'over', 'wheel'];\r\n\tthis.arrSob = [[], [], [], [], [], []];\r\n\r\n\tthis.pozSob = undefined;\r\n\r\n\tthis.dispatcherEvent = function (tipSob, event) {\r\n\t\tfor (var i = 0; i < this.arrSobName.length; i++) {\r\n\t\t\tif (this.arrSobName[i] == tipSob) {\r\n\r\n\t\t\t\tif (event) event.type = tipSob;\r\n\t\t\t\tfor (var j = 0; j < this.arrSob[i].length; j++) {\r\n\t\t\t\t\tthis.arrSob[i][j](event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis.removeEvent = function (str, fun) {\r\n\t\tfor (var i = 0; i < this.arrSobName.length; i++) {\r\n\t\t\tif (this.arrSobName[i] == str) {\r\n\t\t\t\tfor (var j = 0; j < this.arrSob[i].length; j++) {\r\n\t\t\t\t\tif (this.arrSob[i][j] == fun) {\r\n\t\t\t\t\t\tthis.arrSob[i].splice(j, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis.addEvent = function (str, fun) {\r\n\r\n\t\tfor (var i = 0; i < this.arrSobName.length; i++) {\r\n\t\t\tif (this.arrSobName[i] == str) {\r\n\t\t\t\tthis.arrSob[i].push(fun);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n","// то что возврощаеться от событий\r\nexport default function MEvent3D () {\r\n\tthis.target = undefined;\r\n\tthis.face = undefined;\r\n\tthis.point = undefined;\r\n\tthis.faceIndex = undefined;\r\n\tthis.type = undefined;\r\n\tthis.uv = undefined;\r\n\tthis.originalEvent = undefined;\r\n\tthis.copy = function () {\r\n\t\tvar r = new Event3D();\r\n\t\tr.target = this.target;\r\n\t\tr.face = this.face;\r\n\t\tr.point = this.point;\r\n\t\tr.faceIndex = this.faceIndex;\r\n\t\tr.type = this.type;\r\n\t\tr.uv = this.uv;\r\n\t\tr.originalEvent = this.originalEvent;\r\n\t\treturn r;\r\n\t};\r\n}\r\n"],"sourceRoot":""}